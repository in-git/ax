import{a as k,r as p,q as S,s as V,v as N,x as h,g as I,h as B,o as y,i as C,w as a,b as e,y as D,u as t,l as j,f as c,z as J,A as K,j as L,E as z,G as H,I as M,H as Q,J as A,K as W,B as E,L as X,p as Y,e as Z,_ as ee,N as te,O as oe,P as ne,Q as ae,R as le,T as se,U as ue,c as ie,V as _e,C as de}from"./index-DrWGRGWo.js";import{g as re}from"./dict.data-C72Jvica.js";import{P as pe}from"./PlaySquareOutlined-BSwF56Df.js";import{_ as ce}from"./SystemTable.vue_vue_type_script_setup_true_lang-B9sIDfX6.js";import{_ as me}from"./TableHead-BmQvVJ5O.js";import{F as fe}from"./Field-CUE4F3cL.js";import{_ as be}from"./Operation.vue_vue_type_script_setup_true_lang-BsOu1TJ7.js";import"./FilterOutlined-JbdMlQF8.js";const ve=n=>k.get("monitor/job/list",{params:n}),ge=n=>k.delete(`monitor/job/${n.join(",")}`),ye=n=>k.put("monitor/job/run",{data:n}),je=n=>k.get(`monitor/job/${n}`),b=p(!1),G={createBy:"",createTime:"",remark:"",jobId:0,jobName:"",jobGroup:"",invokeTarget:"",cronExpression:"",misfirePolicy:"",concurrent:"",status:"",nextValidTime:""},l=p({...G}),xe=()=>{l.value={...G}},ke=[{label:"默认策略",value:"0"},{label:"立即执行",value:"1"},{label:"执行一次",value:"2"},{label:"放弃执行",value:"3"}],T=p([]),v=p({rowKey:"jobId",data:[],loading:!1,moduleName:"job"}),g=p({pageNum:1,pageSize:10,total:0}),r=p([]),Ie=[{label:"删除",key:"delete",icon:S(V),onClick(){N(U)}},{label:"执行一次",key:"run",icon:S(pe),onClick(){l.value.jobId&&N(ye,{jobGroup:l.value.jobGroup,jobId:l.value.jobId})}}],x=async()=>{v.value.loading=!0;const{data:n}=await ve(g.value);v.value.data=n.rows,g.value.total=n.total,v.value.loading=!1},F=async()=>{const{data:n}=await je(l.value.jobId);n.data&&(l.value=n.data,b.value=!0)},Ce=async()=>{xe(),b.value=!0},U=async n=>{let m=n?[n]:r.value;await N(ge,m),x()},$e=async()=>{const{data:n}=await re("sys_job_group");n.data&&(T.value=h(n.data))},Oe=n=>(Y("data-v-59e9b597"),n=n(),Z(),n),we={class:"h-100 flex flex-col"},Ne=Oe(()=>c("h3",null,"定时任务编辑",-1)),Te={class:"flex-1 p-8"},Ue=I({__name:"form",setup(n){return B(async()=>{await $e(),console.log(T.value)}),(m,o)=>{const u=z,d=H,_=M,i=Q,f=A,$=W,O=E,w=X;return y(),C(w,{model:t(l),"wrapper-col":{span:8},"label-col":{span:4}},{default:a(()=>[e(D,{title:"定时任务表单",visible:t(b),"onUpdate:visible":o[7]||(o[7]=s=>j(b)?b.value=s:null)},{default:a(()=>[c("div",we,[e(d,null,{default:a(()=>[e(u,{span:8,offset:4},{default:a(()=>[Ne]),_:1})]),_:1}),c("div",Te,[e(i,{label:"任务名称"},{default:a(()=>[e(_,{placeholder:"请输入任务名称",value:t(l).jobName,"onUpdate:value":o[0]||(o[0]=s=>t(l).jobName=s)},null,8,["value"])]),_:1}),e(i,{label:"任务分组"},{default:a(()=>[e(f,{value:t(l).jobGroup,"onUpdate:value":o[1]||(o[1]=s=>t(l).jobGroup=s),options:t(T)},null,8,["value","options"])]),_:1}),e(i,{label:"调用方法"},{default:a(()=>[e(_,{placeholder:"调用方法",value:t(l).invokeTarget,"onUpdate:value":o[2]||(o[2]=s=>t(l).invokeTarget=s)},null,8,["value"])]),_:1}),e(i,{label:"表达式"},{default:a(()=>[e(_,{placeholder:"表达式",value:t(l).cronExpression,"onUpdate:value":o[3]||(o[3]=s=>t(l).cronExpression=s)},null,8,["value"])]),_:1}),e(i,{label:"执行策略"},{default:a(()=>[e($,{value:t(l).misfirePolicy,"onUpdate:value":o[4]||(o[4]=s=>t(l).misfirePolicy=s),options:t(ke)},null,8,["value","options"])]),_:1}),e(i,{label:"是否并发"},{default:a(()=>[e(f,{options:t(J),value:t(l).concurrent,"onUpdate:value":o[5]||(o[5]=s=>t(l).concurrent=s)},null,8,["options","value"])]),_:1}),e(i,{label:"状态"},{default:a(()=>[e(f,{options:t(K),value:t(l).status,"onUpdate:value":o[6]||(o[6]=s=>t(l).status=s)},null,8,["options","value"])]),_:1}),e(d,null,{default:a(()=>[e(u,{span:8,offset:4},{default:a(()=>[e(O,{type:"primary","html-type":"submit"},{default:a(()=>[L("保存")]),_:1})]),_:1})]),_:1})])])]),_:1},8,["visible"])]),_:1},8,["model"])}}}),Pe=ee(Ue,[["__scopeId","data-v-59e9b597"]]),R=p([{title:"任务名称",dataIndex:"jobName"},{title:"备注",dataIndex:"remark"},{title:"任务分组",dataIndex:"jobGroup"},{title:"调用目标",dataIndex:"invokeTarget"},{title:"CRON表达式",dataIndex:"cronExpression"},{title:"错失策略",dataIndex:"misfirePolicy"},{title:"并发",dataIndex:"concurrent"},{title:"状态",dataIndex:"status"},{title:"下次有效时间",dataIndex:"nextValidTime"}]),Se={class:"flex justify-between"},Ve={class:"flex gc-4 align-center"},Be={class:"flex"},Ee=I({__name:"head",setup(n){return(m,o)=>{const u=te,d=E,_=oe,i=ne,f=ae,$=le,O=se,w=V,s=ue,q=me;return y(),C(q,{title:"定时任务列表"},{default:a(()=>[c("div",Se,[c("div",Ve,[e(_,{title:"新建"},{default:a(()=>[e(d,{type:"primary",onClick:t(Ce)},{default:a(()=>[e(u)]),_:1},8,["onClick"])]),_:1}),e(_,{title:"编辑"},{default:a(()=>[e(d,{type:"link",onClick:o[0]||(o[0]=P=>t(F)()),disabled:t(r).length!==1},{default:a(()=>[e(i)]),_:1},8,["disabled"])]),_:1}),e(_,{title:"刷新"},{default:a(()=>[e(d,{type:"link",onClick:t(x)},{default:a(()=>[e(f)]),_:1},8,["onClick"])]),_:1}),e($,{type:"vertical"}),e(O,{"allow-clear":"",onSearch:t(x)},null,8,["onSearch"])])]),c("div",Be,[e(s,{title:"确定要删除吗",placement:"bottomRight",onConfirm:o[2]||(o[2]=P=>t(U)()),disabled:t(r).length===0},{default:a(()=>[e(s,{title:"确定要删除吗",placement:"bottomRight",onConfirm:o[1]||(o[1]=P=>t(U)())},{default:a(()=>[e(_,{title:"批量删除"},{default:a(()=>[e(d,{danger:"",type:"link",disabled:t(r).length===0},{default:a(()=>[e(w)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["disabled"]),e(fe,{columns:t(R),"module-name":"test"},null,8,["columns"])])]),_:1})}}}),Ge=I({__name:"table",setup(n){return B(()=>{x()}),(m,o)=>(y(),ie("div",null,[e(Ee),e(ce,{columns:t(R),table:t(v),query:t(g),"onUpdate:query":o[0]||(o[0]=u=>j(g)?g.value=u:null),"selected-keys":t(r),"onUpdate:selectedKeys":o[1]||(o[1]=u=>j(r)?r.value=u:null),form:t(l),"onUpdate:form":o[2]||(o[2]=u=>j(l)?l.value=u:null)},{default:a(({value:u})=>[u.column.dataIndex==="operation"?(y(),C(be,{key:0,onOnClick:t(F),loading:t(v).loading,items:t(Ie)},null,8,["onOnClick","loading","items"])):_e("",!0)]),_:1},8,["columns","table","query","selected-keys","form"])]))}}),ze=I({__name:"index",setup(n){return(m,o)=>{const u=de;return y(),C(u,{class:"system__module"},{default:a(()=>[e(Ge),e(Pe)]),_:1})}}});export{ze as default};
