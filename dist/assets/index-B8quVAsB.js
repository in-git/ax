import{a as O,r as C,q as J,s as M,v as R,g as $,o as i,i as y,w as a,b as t,f as w,t as q,u as e,Y as Z,d as A,C as D,x as ee,y as te,l as ae,j as F,V as j,as as ne,H as le,I as H,ae as P,B as Q,L as oe,ao as se,ap as T,c as I,N as de,O as ue,P as re,Q as pe,U as ie,a6 as ce,ak as _e,aq as me,F as K,k as L,ag as fe,ar as ve,D as ge,m as ye,_ as be,a0 as he,a2 as we,h as ke}from"./index-FS4tF_OB.js";import{g as Ce}from"./dict.data-kV6yApbJ.js";import{F as xe}from"./Field-BH60NeV4.js";import{O as Ie,A as Ne}from"./OrderedListOutlined-CG7DZpse.js";import{_ as $e}from"./Operation.vue_vue_type_script_setup_true_lang-CiedVbK-.js";import"./FilterOutlined-9hy3VxsG.js";const De=n=>O.get("system/dept/list",{params:n}),Be=n=>O.get(`system/dept/${n}`),Oe=n=>O.post("system/dept",n),Se=n=>O.put("/system/dept",n),Fe=n=>O.delete(`system/dept/${n.join(",")}`),N=C(!1),W={deptId:0,parentId:0,ancestors:"",deptName:"",orderNum:0,leader:"",phone:"",email:"",status:"",delFlag:"",createBy:"",createTime:null,updateBy:"",updateTime:null,children:[]},p=C({...W}),Ue=()=>{p.value={...W}},ze={deptName:[{required:!1,trigger:"change"}],orderNum:[{required:!1,trigger:"change"}],leader:[{required:!1,trigger:"change"}],phone:[{required:!1,trigger:"change"}],status:[{required:!1,trigger:"change"}]},k=C({rowKey:"deptId",data:[],loading:!1,moduleName:"dept"}),S=C("table"),c=C({pageNum:1,pageSize:10,total:0,deptName:"",leader:"",phone:"",status:""}),m=C([]),Te=[{label:"删除",key:"delete",icon:J(M),async onClick(){await Y(),b()}}];function Re(n){const s={},o=[];return n.forEach(d=>{s[d.deptId]={...d,children:[]}}),n.forEach(d=>{d.parentId!==0?s[d.parentId].children.push(s[d.deptId]):o.push(s[d.deptId])}),o}const b=async()=>{var s;k.value.loading=!0;const{data:n}=await De(c.value);n.data&&(k.value.data=Re(n.data),c.value.total=(s=n.data)==null?void 0:s.length),k.value.loading=!1},U=async n=>{let s=n||m.value[0];k.value.loading=!0;const{data:o}=await Be(s);o.data&&(p.value=o.data,N.value=!0),k.value.loading=!1},qe=async()=>{Ue(),N.value=!0},Y=async n=>{let s=n?[n]:m.value;await R(Fe,s),await b(),m.value=[]},Ae=w("span",null,"已选:",-1),je=$({__name:"AXFooter",setup(n){const s=(o,d)=>{c.value.pageNum=o,c.value.pageSize=d,b()};return(o,d)=>{const l=Z,_=A,u=D;return i(),y(u,{bordered:!1,bodyStyle:{padding:"4px 12px"},class:"card__footer"},{default:a(()=>[t(_,{justify:"space-between",align:"center"},{default:a(()=>[w("div",null,[Ae,w("span",null,"（"+q(e(m).length)+"）",1)]),t(l,{total:e(c).total,current:e(c).pageNum,"page-size":e(c).pageSize,"show-size-changer":"",onChange:s,"show-quick-jumper":"","show-less-items":""},null,8,["total","current","page-size"])]),_:1})]),_:1})}}}),V=C(),Ve=async()=>{const{data:n}=await Ce("sys_job_status");n.data&&(V.value=ee(n.data))},Ee=$({__name:"AXForm",setup(n){const s=C(!1),o=async()=>{s.value=!0,p.value.deptId?await R(Se,p.value):await R(Oe,p.value),await b(),s.value=!1,N.value=!1};return(d,l)=>{const _=ne,u=le,g=H,r=P,x=Q,v=D,B=oe;return i(),y(B,{rules:e(ze),model:e(p),onFinish:o,"wrapper-col":{span:8,offset:1},"label-col":{span:4,offset:4}},{default:a(()=>[t(te,{title:"部门",visible:e(N),"onUpdate:visible":l[6]||(l[6]=f=>ae(N)?N.value=f:null)},{default:a(()=>[t(v,{title:"编辑/新增"},{extra:a(()=>[t(x,{htmlType:"submit",type:"primary",loading:e(s),block:""},{default:a(()=>[F("保存")]),_:1},8,["loading"])]),default:a(()=>[e(p).parentId!==0?(i(),y(u,{key:0,label:"父级菜单",name:"parentId"},{default:a(()=>[t(_,{allowClear:"","tree-data":e(k).data,value:e(p).parentId,"onUpdate:value":l[0]||(l[0]=f=>e(p).parentId=f),"field-names":{label:"deptName",value:"deptId"}},null,8,["tree-data","value"])]),_:1})):j("",!0),t(u,{label:"部门名称",name:"deptName"},{default:a(()=>[t(g,{placeholder:"请输入部门名称",value:e(p).deptName,"onUpdate:value":l[1]||(l[1]=f=>e(p).deptName=f)},null,8,["value"])]),_:1}),t(u,{label:"显示顺序",name:"orderNum"},{default:a(()=>[t(g,{placeholder:"请输入显示顺序",value:e(p).orderNum,"onUpdate:value":l[2]||(l[2]=f=>e(p).orderNum=f)},null,8,["value"])]),_:1}),t(u,{label:"负责人",name:"leader"},{default:a(()=>[t(g,{placeholder:"请输入负责人",value:e(p).leader,"onUpdate:value":l[3]||(l[3]=f=>e(p).leader=f)},null,8,["value"])]),_:1}),t(u,{label:"联系电话",name:"phone"},{default:a(()=>[t(g,{placeholder:"请输入联系电话",value:e(p).phone,"onUpdate:value":l[4]||(l[4]=f=>e(p).phone=f)},null,8,["value"])]),_:1}),t(u,{label:"部门状态",name:"status"},{default:a(()=>[t(r,{value:e(p).status,"onUpdate:value":l[5]||(l[5]=f=>e(p).status=f),class:"w-100",placeholder:"请选择部门状态","allow-clear":"",onChange:e(b),options:e(V)},null,8,["value","onChange","options"])]),_:1})]),_:1})]),_:1},8,["visible"])]),_:1},8,["rules","model"])}}}),E=C([{title:"部门名称",dataIndex:"deptName"},{title:"显示顺序",dataIndex:"orderNum"},{title:"负责人",dataIndex:"leader"},{title:"联系电话",dataIndex:"phone"},{title:"部门状态",dataIndex:"status"}]),Ke=w("h3",{class:"text-14"},"部门列表",-1),Le=$({__name:"AXHead",setup(n){return(s,o)=>{const d=H,l=P,_=Q,u=A,g=de,r=ue,x=re,v=pe,B=M,f=ie,G=D,z=se("perm");return i(),y(G,{class:"table__head"},{title:a(()=>[Ke]),default:a(()=>[t(u,{class:"mb-12",gap:12,wrap:"wrap"},{default:a(()=>[w("div",null,[t(d,{onBlur:e(b),value:e(c).deptName,"onUpdate:value":o[0]||(o[0]=h=>e(c).deptName=h),style:{width:"160px"},placeholder:"请输入部门名称","allow-clear":""},null,8,["onBlur","value"])]),w("div",null,[t(d,{onBlur:e(b),value:e(c).leader,"onUpdate:value":o[1]||(o[1]=h=>e(c).leader=h),style:{width:"160px"},placeholder:"请输入负责人","allow-clear":""},null,8,["onBlur","value"])]),w("div",null,[t(d,{onBlur:e(b),value:e(c).phone,"onUpdate:value":o[2]||(o[2]=h=>e(c).phone=h),style:{width:"160px"},placeholder:"请输入联系电话","allow-clear":""},null,8,["onBlur","value"])]),w("div",null,[t(l,{value:e(c).status,"onUpdate:value":o[3]||(o[3]=h=>e(c).status=h),style:{width:"160px"},placeholder:"请选择部门状态（0正常 1停用）","allow-clear":"",onBlur:e(b),options:e(V)},null,8,["value","onBlur","options"])]),t(_,{type:"primary",onClick:e(b)},{default:a(()=>[F("搜索")]),_:1},8,["onClick"])]),_:1}),t(u,{justify:"space-between",align:"center"},{default:a(()=>[t(u,{justify:"space-between",align:"center"},{default:a(()=>[t(u,{align:"center",gap:4},{default:a(()=>[T((i(),I("div",null,[t(r,{title:"新建"},{default:a(()=>[t(_,{type:"primary",onClick:e(qe)},{default:a(()=>[t(g)]),_:1},8,["onClick"])]),_:1})])),[[z,"system:dept:add"]]),T((i(),I("div",null,[t(r,{title:"编辑"},{default:a(()=>[t(_,{type:"link",onClick:o[4]||(o[4]=h=>e(U)()),disabled:e(m).length!==1},{default:a(()=>[t(x)]),_:1},8,["disabled"])]),_:1})])),[[z,"system:dept:edit"]]),t(r,{title:"刷新"},{default:a(()=>[t(_,{type:"link",onClick:e(b)},{default:a(()=>[t(v)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),t(u,null,{default:a(()=>[T((i(),I("div",null,[t(f,{title:"确定要删除吗",disabled:e(m).length===0,placement:"bottomRight",onConfirm:o[5]||(o[5]=h=>e(Y)())},{default:a(()=>[t(r,{title:"批量删除"},{default:a(()=>[t(_,{danger:"",type:"link",disabled:e(m).length===0},{default:a(()=>[t(B)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["disabled"])])),[[z,"system:dept:remove"]]),t(xe,{columns:e(E),"module-name":e(k).moduleName},null,8,["columns","module-name"]),w("div",null,[e(S)==="table"?(i(),y(r,{key:0,title:"卡片模式",onClick:o[6]||(o[6]=h=>S.value="card")},{default:a(()=>[t(_,{type:"link"},{default:a(()=>[t(e(Ie))]),_:1})]),_:1})):(i(),y(r,{key:1,title:"表格模式",onClick:o[7]||(o[7]=h=>S.value="table")},{default:a(()=>[t(_,{type:"link"},{default:a(()=>[t(e(Ne))]),_:1})]),_:1}))])]),_:1})]),_:1})]),_:1})}}}),Xe=n=>{console.log("dragstart==",n.id)},Me=n=>{console.log("drop==",n.id)},He=n=>{m.value.includes(n.id)?m.value=m.value.filter(s=>s!==n.id):m.value.push(n.id)},X=ce(()=>{let n=[];return k.value.data.map((s,o)=>{let d=[];E.value.forEach((l,_)=>{const u=l.title,g=s[l.dataIndex];l.dataIndex!=="operation"&&d.push({label:u,value:g})}),n.push({id:s.deptId,items:d,raw:s})}),n}),Pe=["onClick","onDblclick","onDragstart","onDrop"],Qe={key:0,class:"active"},We=$({__name:"AXCard",setup(n){const s=C();return _e(()=>{me(s,X.value,{animation:200,onUpdate(o){}})}),(o,d)=>{const l=ve,_=ge,u=ye,g=D;return i(),y(g,{class:"table__card",bordered:!1,"body-style":{padding:"0"}},{default:a(()=>[w("ul",{class:"table_card_list flex-1",ref_key:"cardRef",ref:s},[(i(!0),I(K,null,L(e(X),(r,x)=>(i(),I("li",{key:x,size:"small",onClick:v=>e(He)(r),class:fe({active:e(m).includes(r.id)}),onDblclick:v=>e(U)(r.id),draggable:!0,onDragstart:v=>e(Xe)(r),onDrop:v=>e(Me)(r),onDragover:d[0]||(d[0]=v=>v.preventDefault())},[t(g,null,{default:a(()=>[e(m).includes(r.id)?(i(),I("div",Qe,q(x+1),1)):j("",!0),t(l,{title:r.items[0].value,class:"mb-8"},{description:a(()=>[F("详细信息")]),_:2},1032,["title"]),t(u,{column:1,layout:"horizontal",labelStyle:{width:"80px",color:"#666"}},{default:a(()=>[(i(!0),I(K,null,L(r.items,(v,B)=>(i(),y(_,{label:v.label,contentStyle:{fontWeight:B===0?"bold":""}},{default:a(()=>[F(q(v.value),1)]),_:2},1032,["label","contentStyle"]))),256))]),_:2},1024)]),_:2},1024)],42,Pe))),128))],512)]),_:1})}}}),Ye=be(We,[["__scopeId","data-v-86d33bc3"]]),Ge=$({__name:"AXTable",setup(n){const s=l=>{p.value=l},o=l=>({onClick(){m.value=[l.deptId]},onDblclick(){U(l.deptId)}}),d=(l,_,u)=>{c.value.pageNum=l.current,c.value.pageSize=l.pageSize};return(l,_)=>{const u=we,g=D;return i(),y(g,{style:{boxShadow:"none"}},{default:a(()=>[t(u,{onChange:d,"table-layout":"fixed",sticky:"","row-selection":{selectedRowKeys:e(m),onChange:r=>m.value=r},pagination:!1,customRow:o,rowKey:e(k).rowKey,columns:e(he)(e(E)),"data-source":e(k).data},{bodyCell:a(({column:r,record:x})=>[r.key==="operation"?(i(),y($e,{key:0,loading:e(k).loading,onOpenChange:v=>s(x),onOnClick:v=>e(U)(x.deptId),items:e(Te)},null,8,["loading","onOpenChange","onOnClick","items"])):j("",!0)]),_:1},8,["row-selection","rowKey","columns","data-source"])]),_:1})}}}),Je={class:"data__content"},ot=$({__name:"index",setup(n){return ke(async()=>{await b(),await Ve()}),(s,o)=>{const d=A,l=D;return i(),y(l,{class:"system__template","body-style":{height:"100%",overflow:"hidden",paddingBottom:"0"}},{default:a(()=>[t(d,{vertical:"",class:"h-100"},{default:a(()=>[t(Le),w("div",Je,[e(S)==="table"?(i(),y(Ge,{key:0})):(i(),y(Ye,{key:1}))]),t(je),t(Ee)]),_:1})]),_:1})}}});export{ot as default};
