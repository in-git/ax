import{r as v,M as se,cc as le,a7 as P,cd as ne,ce as oe,cf as ue,g as C,Z as de,o as k,i as K,w as s,b as e,u as t,l as U,T as ie,cb as L,C as O,p as R,e as j,f as p,_ as T,h as M,c as F,ae as _e,X as re,y as E,j as S,V as H,cg as ce,A as pe,ch as me,ci as ve,B,d as A,I as Q,H as G,J as fe,an as ge,E as ye,G as be,L as J,q as V,s as X,cj as we,ck as xe,Q as ke,c9 as Ie,av as he,N as Ce,O as $e,P as Ue,K as Ne,R as Se,a0 as Ke,a2 as Oe}from"./index-BKuZjElQ.js";import{_ as Te}from"./Operation.vue_vue_type_script_setup_true_lang-0TYptOtC.js";import{L as Fe}from"./LockOutlined-DTuk42P6.js";import{_ as Pe}from"./TableHead-DBWR7B7x.js";import{_ as Re}from"./ExportOutlined-CKaBPuLg.js";const x=v({data:[],loading:!1,selectedKeys:[]}),y=v({pageNum:1,pageSize:20,total:0,status:"0",userName:"",phonenumber:"",deptId:void 0}),I=v(!1);let Z={createBy:"",createTime:"",remark:"",userId:void 0,deptId:0,userName:"",nickName:"",email:"",phonenumber:"",sex:"0",avatar:"",password:"",status:"0",delFlag:"",loginIp:"",loginDate:"",roles:[],admin:!1,roleId:void 0,postIds:[],roleIds:[]};const n=v({...Z}),D=v([]),W=v([]),je=async()=>{n.value={...Z},await z(),console.log(D.value)},Y=o=>{se.confirm({title:"警告",content:"是否要删除用户",async onOk(){let l=[];o?l=[o]:l=x.value.selectedKeys;const{data:i}=await le(l);await h(),P.success(i.msg)}})},z=async o=>{const{data:l}=await ne(o||"");l.data&&(n.value=l.data,n.value.roleIds=l.roleIds,n.value.postIds=l.postIds),D.value=l.roles,W.value=l.posts,I.value=!0},Be=()=>{I.value=!1,je()},h=async()=>{x.value.loading=!0;const{data:o}=await oe(y.value);x.value.data=o.rows,y.value.total=o.total,x.value.loading=!1},$=v([]),ee=async()=>{const{data:o}=await ue();o.data&&($.value=o.data)},te=(o,l)=>{for(const i of l){if(i.label.includes(o))return[i];if(i.children){const d=te(o,i.children);if(d)return d}}return null},De=o=>(R("data-v-ab7556b3"),o=o(),j(),o),ze=De(()=>p("h3",null,"用户部门",-1)),qe=C({__name:"Dept",setup(o){const l=v([]),i=v(),d=v(""),a=v([]),u=()=>{let _=te(d.value,$.value)||[];i.value=_},g=_=>{y.value.deptId=Number(_[0]),h()};return de($,async()=>{$.value.length===0&&await ee(),i.value=$.value,console.log(i.value)},{immediate:!0}),(_,r)=>{const b=ie,m=L,w=O;return k(),K(w,{class:"dept mr-4"},{default:s(()=>[ze,e(b,{"allow-clear":"",value:t(d),"onUpdate:value":r[0]||(r[0]=f=>U(d)?d.value=f:null),placeholder:"请输入部门名称",onSearch:u,class:"my-8"},null,8,["value"]),e(m,{"tree-data":t(i),onSelect:g,selectable:"",checkable:!1,"expanded-keys":t(l),"onUpdate:expandedKeys":r[1]||(r[1]=f=>U(l)?l.value=f:null),"selected-keys":t(a),"onUpdate:selectedKeys":r[2]||(r[2]=f=>U(a)?a.value=f:null),blockNode:"","default-expand-all":!0,fieldNames:{title:"label",key:"id"}},null,8,["tree-data","expanded-keys","selected-keys"])]),_:1})}}}),Ve=T(qe,[["__scopeId","data-v-ab7556b3"]]),q=o=>(R("data-v-8d715e8b"),o=o(),j(),o),Le={class:"flex justify-between"},Me=q(()=>p("div",null,"角色分配",-1)),Ee={class:"flex justify-between"},He=q(()=>p("div",null,"岗位分配",-1)),Ae={class:"flex justify-between"},Qe=q(()=>p("div",null,"部门分配",-1)),Ge=C({__name:"Right",setup(o){const l=v(),i=v([]),d=()=>{n.value.deptId=i.value[0]||0};return M(async()=>{await ee(),l.value=$.value,i.value.push(n.value.deptId)}),(a,u)=>{const g=_e,_=L,r=re,b=O;return k(),F("div",null,[e(b,{title:"权限分配"},{default:s(()=>[e(r,{class:"w-100",direction:"vertical",size:20},{default:s(()=>[p("div",Le,[Me,e(g,{value:t(n).roleIds,"onUpdate:value":u[0]||(u[0]=m=>t(n).roleIds=m),style:{width:"200px"},"field-names":{label:"roleName",value:"roleId"},allowClear:"",mode:"multiple",options:t(D)},null,8,["value","options"])]),p("div",Ee,[He,e(g,{value:t(n).postIds,"onUpdate:value":u[1]||(u[1]=m=>t(n).postIds=m),style:{width:"200px"},allowClear:"",mode:"multiple","field-names":{label:"postName",value:"postId"},options:t(W)},null,8,["value","options"])]),p("div",Ae,[Qe,e(_,{style:{width:"200px"},"tree-data":t(l),selectable:"","selected-keys":t(i),"onUpdate:selectedKeys":u[2]||(u[2]=m=>U(i)?i.value=m:null),blockNode:"","default-expand-all":!0,fieldNames:{children:"children",title:"label",key:"id"},onSelect:d},null,8,["tree-data","selected-keys"])])]),_:1})]),_:1})])}}}),Je=T(Ge,[["__scopeId","data-v-8d715e8b"]]),Xe=o=>(R("data-v-21467d7c"),o=o(),j(),o),Ze={class:"mb-8 px-12 py-8"},We=Xe(()=>p("span",null,"编辑用户信息",-1)),Ye={class:"p-8",title:"基础信息"},et=C({__name:"UserForm",setup(o){const l=v(!1),i=async()=>{l.value=!0;let d="";try{if(n.value.userId){const{data:a}=await ve(n.value);d=a.msg}else{const{data:a}=await me(n.value);d=a.msg}l.value=!1,P.success(d),I.value=!1,h()}catch{l.value=!1}};return(d,a)=>{const u=B,g=A,_=Q,r=G,b=fe,m=ge,w=ye,f=be,ae=J;return k(),K(ae,{model:t(n),"label-align":"left",class:"form",onFinish:i,"label-col":{span:8}},{default:s(()=>[e(E,{w:"90%",h:"90%",visible:t(I),"onUpdate:visible":[a[8]||(a[8]=c=>U(I)?I.value=c:null),a[9]||(a[9]=c=>I.value=!1)],title:"用户中心"},{default:s(()=>[p("div",null,[p("div",Ze,[e(g,{justify:"space-between"},{default:s(()=>[We,e(u,{type:"primary",loading:t(l),htmlType:"submit"},{default:s(()=>[S("保存")]),_:1},8,["loading"])]),_:1})]),e(f,{gutter:12},{default:s(()=>[e(w,{span:12},{default:s(()=>[p("div",Ye,[e(r,{label:"昵称",name:"nickName",required:""},{default:s(()=>[e(_,{value:t(n).nickName,"onUpdate:value":a[0]||(a[0]=c=>t(n).nickName=c),focused:"",placeholder:"请输入昵称"},null,8,["value"])]),_:1}),e(r,{label:"账号",name:"userName",required:""},{default:s(()=>[e(_,{disabled:!1,value:t(n).userName,"onUpdate:value":a[1]||(a[1]=c=>t(n).userName=c),placeholder:"请输入账号"},null,8,["value"])]),_:1}),t(n).userId?H("",!0):(k(),K(r,{key:0,label:"密码",required:""},{default:s(()=>[e(_,{type:"password",value:t(n).password,"onUpdate:value":a[2]||(a[2]=c=>t(n).password=c),placeholder:"请输入密码"},null,8,["value"])]),_:1})),e(r,{label:"手机号码",name:"phonenumber",rules:{len:11}},{default:s(()=>[e(_,{maxlength:11,value:t(n).phonenumber,"onUpdate:value":a[3]||(a[3]=c=>t(n).phonenumber=c),placeholder:"请输入手机号码"},null,8,["value"])]),_:1}),e(r,{label:"邮箱",name:"email"},{default:s(()=>[e(_,{value:t(n).email,"onUpdate:value":a[4]||(a[4]=c=>t(n).email=c),type:"email",placeholder:"请输入邮箱"},null,8,["value"])]),_:1}),e(r,{label:"性别",name:"sex"},{default:s(()=>[e(b,{value:t(n).sex,"onUpdate:value":a[5]||(a[5]=c=>t(n).sex=c),options:t(ce)},null,8,["value","options"])]),_:1}),e(r,{label:"状态",name:"status"},{default:s(()=>[e(b,{value:t(n).status,"onUpdate:value":a[6]||(a[6]=c=>t(n).status=c),options:t(pe)},null,8,["value","options"])]),_:1}),e(r,{label:"备注",name:"remark"},{default:s(()=>[e(m,{placeholder:"请输入备注信息","auto-size":{minRows:2,maxRows:6},value:t(n).remark,"onUpdate:value":a[7]||(a[7]=c=>t(n).remark=c)},null,8,["value"])]),_:1})])]),_:1}),e(w,{span:12},{default:s(()=>[e(Je)]),_:1})]),_:1})])]),_:1},8,["visible"])]),_:1},8,["model"])}}}),tt=T(et,[["__scopeId","data-v-21467d7c"]]),at=[{title:"用户名",dataIndex:"userName"},{title:"昵称",dataIndex:"nickName"},{title:"邮箱",dataIndex:"email"},{title:"登录IP",dataIndex:"loginIp"},{title:"电话",dataIndex:"phonenumber"},{title:"备注",dataIndex:"remark"},{title:"操作",dataIndex:"operation"}],st=at,N=v(!1),lt=[{label:"删除用户",key:"delete",icon:V(X),async onClick(){Y()}},{label:"修改密码",key:"update",icon:V(Fe),async onClick(){N.value=!0}}],nt=C({__name:"ChangePassword",setup(o){const l=v({password:""}),i=async()=>{const{data:a}=await we(l.value.password,n.value.userId);P.success(a.msg),N.value=!1,l.value.password=""},d={min:6,max:16,type:"string",required:!0};return(a,u)=>{const g=xe,_=G,r=B,b=J,m=O;return k(),F("div",null,[e(E,{visible:t(N),"onUpdate:visible":u[1]||(u[1]=w=>U(N)?N.value=w:null),w:"300px",h:"200px",title:"修改密码"},{default:s(()=>[e(m,{bordered:!1},{default:s(()=>[e(b,{model:t(l),layout:"vertical",onSubmit:i},{default:s(()=>[e(_,{required:"",name:"password",label:"新的密码",rules:d},{default:s(()=>[e(g,{maxlength:16,allowClear:"",value:t(l).password,"onUpdate:value":u[0]||(u[0]=w=>t(l).password=w),placeholder:"请输入新的密码"},null,8,["value"])]),_:1}),e(r,{type:"primary",block:"",htmlType:"submit"},{default:s(()=>[S("确定")]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["visible"])])}}}),ot=T(nt,[["__scopeId","data-v-1a51911f"]]),ut={class:"flex-1"},dt={class:"mb-8 flex gc-8 system-subtitle"},it={class:"flex justify-between"},_t={class:"flex gc-4"},rt={class:"flex gc-4 align-center"},ct=C({__name:"UserTableHead",setup(o){const l=async()=>{await he({url:"system/user/export",data:{pageNum:y.value.pageNum,pageSize:y.value.pageSize},fileName:"用户表",method:"POST"})};return(i,d)=>{const a=Q,u=B,g=Ce,_=$e,r=Ue,b=Ne,m=Se,w=Pe;return k(),F("div",null,[e(w,{title:"用户列表"},{default:s(()=>[p("div",ut,[p("div",dt,[p("div",null,[S(" 用户名 "),e(a,{"allow-clear":"",style:{width:"180px"},value:t(y).userName,"onUpdate:value":d[0]||(d[0]=f=>t(y).userName=f)},null,8,["value"])]),p("div",null,[S(" 手机号 "),e(a,{"allow-clear":"",style:{width:"180px"},value:t(y).phonenumber,"onUpdate:value":d[1]||(d[1]=f=>t(y).phonenumber=f)},null,8,["value"])]),e(u,{type:"primary",onClick:t(h)},{default:s(()=>[S("搜索")]),_:1},8,["onClick"])]),p("div",it,[p("div",_t,[e(_,{title:"新建用户"},{default:s(()=>[e(u,{type:"primary",onClick:t(Be)},{default:s(()=>[e(g)]),_:1},8,["onClick"])]),_:1}),e(_,{title:"刷新"},{default:s(()=>[e(u,{onClick:t(h)},{default:s(()=>[e(t(ke))]),_:1},8,["onClick"])]),_:1}),e(_,{title:"编辑"},{default:s(()=>[e(u,{onClick:d[2]||(d[2]=f=>t(z)()),disabled:t(x).selectedKeys.length!==1},{default:s(()=>[e(r)]),_:1},8,["disabled"])]),_:1}),e(_,{title:"导出"},{default:s(()=>[e(u,{onClick:l},{default:s(()=>[e(t(Re))]),_:1})]),_:1})]),p("div",rt,[e(b,{options:t(Ie)("启用","禁用"),value:t(y).status,"onUpdate:value":d[3]||(d[3]=f=>t(y).status=f),onChange:t(h)},null,8,["options","value","onChange"]),e(m,{type:"vertical"}),e(u,{onClick:d[4]||(d[4]=f=>t(Y)()),danger:""},{default:s(()=>[e(t(X))]),_:1})])])])]),_:1})])}}}),pt={class:"flex-1"},mt=C({__name:"UserTable",setup(o){const l=u=>{n.value=u};M(()=>{h()});const i=u=>{x.value.selectedKeys=u.map(g=>Number(g))},d=u=>({onClick(){x.value.selectedKeys=[Number(u.userId)]}}),a=(u,g,_)=>{y.value.pageNum=u.current||0,y.value.pageSize=u.pageSize||0,!(_ instanceof Array)&&_.columnKey&&(y.value.orderByColumn=`${_.columnKey}`)};return(u,g)=>{const _=Oe,r=O;return k(),F("div",pt,[e(ct),e(r,{class:"mt-8"},{default:s(()=>[e(_,{columns:t(Ke)(t(st)),dataSource:t(x).data,loading:t(x).loading,onChange:a,sticky:"","row-selection":{selectedRowKeys:t(x).selectedKeys,onChange:i},customRow:d,rowKey:"userId"},{bodyCell:s(({column:b,record:m})=>[b.dataIndex==="operation"?(k(),K(Te,{key:0,loading:t(x).loading,onOpenChange:w=>l(m),onOnClick:w=>t(z)(m.userId),items:t(lt)},null,8,["loading","onOpenChange","onOnClick","items"])):H("",!0)]),_:1},8,["columns","dataSource","loading","row-selection"])]),_:1}),e(ot)])}}}),wt=C({__name:"index",setup(o){return(l,i)=>{const d=A,a=O;return k(),K(a,{class:"system__module card__container","body-style":{padding:"0",height:"100%"}},{default:s(()=>[e(d,{class:"h-100 flex-1"},{default:s(()=>[e(Ve),e(mt),e(tt)]),_:1})]),_:1})}}});export{wt as default};
