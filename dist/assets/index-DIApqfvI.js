import{a as R,av as ne,a7 as Q,r as C,q as ae,s as E,v as W,cl as J,g as D,o as u,i as b,w as n,b as e,f,t as q,u as t,Y as oe,d as A,C as F,x as se,y as le,l as ie,j as I,T as ue,ax as re,H as _e,I as Y,an as ce,ae as de,B as V,L as pe,ao as me,c as S,F as K,k as G,ap as z,c7 as fe,J as ge,N as ve,O as be,P as ye,Q as we,U as he,a6 as ke,ak as xe,aq as Ce,cm as Z,cn as H,n as $e,_ as Ie,a0 as Se,V as Oe,co as Ue,a3 as Ne,a4 as Re,c0 as De,a2 as Fe,h as Te}from"./index-FS4tF_OB.js";import{g as Be}from"./dict.data-kV6yApbJ.js";import{F as Le}from"./Field-BH60NeV4.js";import{O as ze,A as je}from"./OrderedListOutlined-CG7DZpse.js";import{_ as qe}from"./ExportOutlined-BJCAdxfh.js";import{_ as Ae}from"./LinkOutlined-YsgTaS9j.js";import"./FilterOutlined-9hy3VxsG.js";const We=a=>R.get("system/website/list",{params:a}),Ee=a=>R.get(`system/website/${a}`),Ve=a=>R.post("system/website",a),Ke=a=>R.put("/system/website",a),Xe=a=>R.delete(`system/website/${a.join(",")}`),Me=async a=>{await ne({url:"system/website/export",data:void 0,fileName:"TEST.xls",method:"POST"}),Q.success("成功下载")},Pe=a=>R.get(`system/website/siteInfo/${a}`),N=C(!1),ee={websiteId:0,name:"",url:"",createTime:null,description:"",type:"",updateTime:null},_=C({...ee}),He=()=>{_.value={...ee}},Qe={name:[{required:!0,trigger:"change"}],url:[{required:!0,trigger:"change"}],createTime:[{required:!1,trigger:"change"}],type:[{required:!0,trigger:"change"}]},y=C({rowKey:"websiteId",data:[],loading:!1,moduleName:"website"}),j=C("card"),d=C({pageNum:1,pageSize:20,total:0,name:"",url:"",type:"image"}),x=C([]);ae(E);const k=async()=>{y.value.loading=!0;const{data:a}=await We(d.value);y.value.data=a.rows,d.value.total=a.total,y.value.loading=!1},te=async a=>{let l=a||x.value[0];y.value.loading=!0;const{data:c}=await Ee(l);c.data&&(_.value=c.data,N.value=!0),y.value.loading=!1},Je=async()=>{He(),N.value=!0},X=async a=>{let l=a?[a]:x.value;await W(Xe,l),await k(),x.value=[]},Ye=()=>Me({pageNum:d.value.pageNum,pageSize:d.value.pageSize}),Ge=a=>{var c;const l=J();return a!==((c=l.$state.userInfo)==null?void 0:c.userId)},Ze=f("span",null,"已选:",-1),et=D({__name:"AXFooter",setup(a){const l=(c,o)=>{d.value.pageNum=c,d.value.pageSize=o,console.log(c,o),k()};return(c,o)=>{const m=oe,i=A,s=F;return u(),b(s,{bordered:!1,bodyStyle:{padding:"4px 12px"},class:"card__footer"},{default:n(()=>[e(i,{justify:"space-between",align:"center"},{default:n(()=>[f("div",null,[Ze,f("span",null,"（"+q(t(x).length)+"）",1)]),e(m,{total:t(d).total,current:t(d).pageNum,"page-size":t(d).pageSize,"show-size-changer":"",onChange:l,"show-quick-jumper":"","show-less-items":""},null,8,["total","current","page-size"])]),_:1})]),_:1})}}}),M=C(),tt=async()=>{const{data:a}=await Be("website_type");a.data&&(M.value=se(a.data))},nt=f("div",{class:"system-subtitle"},"http(s)://",-1),at={class:"system-subtitle mt-4"},ot=D({__name:"AXForm",setup(a){const l=C(!1),c=i=>{try{const s=new URL(i).hostname,r=s.split(".");return r.length>2?r.slice(-2).join("."):s}catch(s){return console.error("Invalid URL:",s),""}},o=async()=>{if(_.value.url){let i=c(_.value.url);try{const{data:s}=await Pe(i);s.data&&i&&(_.value.description=s.data.description,_.value.name=s.data.title)}catch{Q.warn("获取失败，请手动填写信息")}}},m=async()=>{l.value=!0,_.value.websiteId?await W(Ke,_.value):await W(Ve,_.value),await k(),l.value=!1,N.value=!1};return(i,s)=>{const r=ue,w=re,g=_e,h=Y,T=ce,O=de,B=V,L=F,$=pe;return u(),b($,{rules:t(Qe),model:t(_),onFinish:m,"wrapper-col":{span:8,offset:1},"label-col":{span:4,offset:4}},{default:n(()=>[e(le,{title:"网页收藏",visible:t(N),"onUpdate:visible":s[4]||(s[4]=p=>ie(N)?N.value=p:null)},{default:n(()=>[e(L,{title:"编辑/新增"},{extra:n(()=>[e(B,{htmlType:"submit",type:"primary",loading:t(l),block:""},{default:n(()=>[I("保存")]),_:1},8,["loading"])]),default:n(()=>[e(g,{label:"网页URL",name:"url"},{default:n(()=>[e(r,{placeholder:"请输入网页URL",value:t(_).url,"onUpdate:value":s[0]||(s[0]=p=>t(_).url=p),onSearch:o},{prefix:n(()=>[nt]),_:1},8,["value"]),f("div",at,[e(w),I(" 点击搜索能自动获取网页信息 ")])]),_:1}),e(g,{label:"网页名称",name:"name"},{default:n(()=>[e(h,{placeholder:"请输入网页名称",value:t(_).name,"onUpdate:value":s[1]||(s[1]=p=>t(_).name=p)},null,8,["value"])]),_:1}),e(g,{label:"网页描述",name:"description"},{default:n(()=>[e(T,{placeholder:"请输入网页描述","auto-size":{minRows:5},maxlength:140,"show-count":"",value:t(_).description,"onUpdate:value":s[2]||(s[2]=p=>t(_).description=p)},null,8,["value"])]),_:1}),e(g,{label:"网页类型",name:"type"},{default:n(()=>[e(O,{value:t(_).type,"onUpdate:value":s[3]||(s[3]=p=>t(_).type=p),class:"w-100",placeholder:"请选择网页类型","allow-clear":"",onChange:t(k),options:t(M)},null,8,["value","onChange","options"])]),_:1})]),_:1})]),_:1},8,["visible"])]),_:1},8,["rules","model"])}}}),P=C([{title:"网页名称",dataIndex:"name"},{title:"网页URL",dataIndex:"url"},{title:"网页描述",dataIndex:"description"},{title:"网页类型",dataIndex:"type"},{title:"来源",dataIndex:"from"}]),st=f("h3",{class:"text-14"},"网页收藏列表",-1),lt=D({__name:"AXHead",setup(a){const l=()=>{d.value.pageNum=1,k()};return(c,o)=>{const m=fe,i=ge,s=Y,r=V,w=A,g=ve,h=be,T=ye,O=we,B=qe,L=E,$=he,p=F,U=me("perm");return u(),b(p,{class:"table__head"},{title:n(()=>[st]),default:n(()=>[e(w,{class:"mb-12",wrap:"wrap",justify:"space-between"},{default:n(()=>[f("div",null,[e(i,{value:t(d).type,"onUpdate:value":o[0]||(o[0]=v=>t(d).type=v),placeholder:"请选择网页类型","allow-clear":"",onChange:l},{default:n(()=>[(u(!0),S(K,null,G(t(M),v=>(u(),b(m,{value:v.value},{default:n(()=>[I(q(v.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),e(w,{gap:12},{default:n(()=>[f("div",null,[e(s,{onBlur:t(k),value:t(d).name,"onUpdate:value":o[1]||(o[1]=v=>t(d).name=v),style:{width:"160px"},placeholder:"请输入网页名称","allow-clear":""},null,8,["onBlur","value"])]),f("div",null,[e(s,{onBlur:t(k),value:t(d).url,"onUpdate:value":o[2]||(o[2]=v=>t(d).url=v),style:{width:"160px"},placeholder:"请输入网页URL","allow-clear":""},null,8,["onBlur","value"])]),e(r,{type:"primary",onClick:t(k)},{default:n(()=>[I("搜索")]),_:1},8,["onClick"])]),_:1})]),_:1}),e(w,{justify:"space-between",align:"center"},{default:n(()=>[e(w,{justify:"space-between",align:"center"},{default:n(()=>[e(w,{align:"center",gap:4},{default:n(()=>[z((u(),S("div",null,[e(h,{title:"新建"},{default:n(()=>[e(r,{type:"primary",onClick:t(Je)},{default:n(()=>[e(g)]),_:1},8,["onClick"])]),_:1})])),[[U,"system:website:add"]]),z((u(),S("div",null,[e(h,{title:"编辑 ( 双击 )"},{default:n(()=>[e(r,{type:"link",onClick:o[3]||(o[3]=v=>t(te)()),disabled:t(x).length!==1},{default:n(()=>[e(T)]),_:1},8,["disabled"])]),_:1})])),[[U,"system:website:edit"]]),e(h,{title:"刷新"},{default:n(()=>[e(r,{type:"link",onClick:t(k)},{default:n(()=>[e(O)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),e(w,null,{default:n(()=>[e(h,{title:"导出"},{default:n(()=>[e(r,{type:"link",onClick:t(Ye)},{default:n(()=>[e(B)]),_:1},8,["onClick"])]),_:1}),z((u(),S("div",null,[e($,{title:"确定要删除吗",disabled:t(x).length===0,placement:"bottomRight",onConfirm:o[4]||(o[4]=v=>t(X)())},{default:n(()=>[e(h,{title:"批量删除"},{default:n(()=>[e(r,{danger:"",type:"link",disabled:t(x).length===0},{default:n(()=>[e(L)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["disabled"])])),[[U,"system:website:remove"]]),e(Le,{columns:t(P),"module-name":t(y).moduleName},null,8,["columns","module-name"]),f("div",null,[t(j)==="table"?(u(),b(h,{key:0,title:"卡片模式",onClick:o[5]||(o[5]=v=>j.value="card")},{default:n(()=>[e(r,{type:"link"},{default:n(()=>[e(t(ze))]),_:1})]),_:1})):(u(),b(h,{key:1,title:"表格模式",onClick:o[6]||(o[6]=v=>j.value="table")},{default:n(()=>[e(r,{type:"link"},{default:n(()=>[e(t(je))]),_:1})]),_:1}))])]),_:1})]),_:1})]),_:1})}}}),it=ke(()=>{let a=[];return y.value.data.map((l,c)=>{let o=[];P.value.forEach((m,i)=>{const s=m.title,r=l[m.dataIndex];m.dataIndex!=="operation"&&o.push({label:s,value:r})}),a.push({id:l.websiteId,items:o,raw:l})}),a}),ut=["onDblclick"],rt=["src"],_t={class:"site-title"},ct={class:"text-right"},dt={class:"system-subtitle"},pt=D({__name:"AXCard",setup(a){const l=C();function c(o,m="http"){return o.startsWith("http://")||o.startsWith("https://")?o:`${m}://${o}/`}return xe(()=>{Ce(l,it.value,{animation:200,onUpdate(o){}})}),(o,m)=>{const i=V,s=A,r=$e,w=F;return u(),b(w,{class:"table__card"},{default:n(()=>[z(f("ul",{class:"table_card_list flex-1",ref_key:"cardRef",ref:l},[(u(!0),S(K,null,G(t(y).data,g=>(u(),S("li",{draggable:!0,key:g.websiteId,onDblclick:h=>t(Z)(g.url)},[f("img",{src:`https://favicon.qqsuu.cn/${g.url}`,width:"36",height:"36"},null,8,rt),e(s,{class:"flex-1",vertical:"",gap:2},{default:n(()=>[e(s,{justify:"space-between"},{default:n(()=>[f("div",_t,q(g.name),1),f("div",ct,[e(i,{target:"_blank",href:c(g.url),type:"link",class:"open"},{default:n(()=>[I(" 打开 ")]),_:2},1032,["href"])])]),_:2},1024),f("div",dt,q(g.description),1)]),_:2},1024)],40,ut))),128))],512),[[H,t(y).data.length>0]]),z(e(r,null,null,512),[[H,t(y).data.length===0]])]),_:1})}}}),mt=Ie(pt,[["__scopeId","data-v-155d3a73"]]),ft=D({__name:"AXTable",setup(a){const l=J(),c=i=>{_.value=i},o=i=>({onClick(){x.value=[i.websiteId]},onDblclick(){te(i.websiteId)}}),m=(i,s,r)=>{d.value.pageNum=i.current,d.value.pageSize=i.pageSize};return(i,s)=>{const r=Ae,w=E,g=Ue,h=Ne,T=Re,O=De,B=Fe,L=F;return u(),b(L,{style:{boxShadow:"none"},"body-style":{padding:"0"}},{default:n(()=>[e(B,{onChange:m,"table-layout":"fixed",sticky:"","row-selection":{selectedRowKeys:t(x),onChange:$=>x.value=$},loading:t(y).loading,bordered:!1,pagination:!1,customRow:o,rowKey:t(y).rowKey,columns:t(Se)(t(P)),"data-source":t(y).data},{bodyCell:n(({column:$,record:p})=>{var U;return[$.key==="operation"?(u(),b(T,{key:0,trigger:"click",onClick:v=>t(Z)(p.url),onOpenChange:v=>c(p)},{overlay:n(()=>[e(h,null,{default:n(()=>[e(g,{disabled:t(Ge)(p.userId),onClick:v=>t(X)(p.userId)},{icon:n(()=>[e(w)]),default:n(()=>[I(" 删除 ")]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),default:n(()=>[e(r)]),_:2},1032,["onClick","onOpenChange"])):$.key==="from"?(u(),S(K,{key:1},[p.userId===((U=t(l).$state.userInfo)==null?void 0:U.userId)?(u(),b(O,{key:0,bordered:!1,color:"green"},{default:n(()=>[I(" 自己 ")]),_:1})):(u(),b(O,{key:1,color:"orange",bordered:!1},{default:n(()=>[I("超管")]),_:1}))],64)):Oe("",!0)]}),_:1},8,["row-selection","loading","rowKey","columns","data-source"])]),_:1})}}}),gt={class:"data__content"},Ct=D({__name:"index",setup(a){return Te(async()=>{await k(),await tt()}),(l,c)=>{const o=A,m=F;return u(),b(m,{class:"system__template","body-style":{height:"100%",overflow:"hidden",paddingBottom:"0"}},{default:n(()=>[e(o,{vertical:"",class:"h-100"},{default:n(()=>[e(lt),f("div",gt,[t(j)==="table"?(u(),b(ft,{key:0})):(u(),b(mt,{key:1}))]),e(et),e(ot)]),_:1})]),_:1})}}});export{Ct as default};
