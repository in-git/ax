import{b as e,A as se,r as v,M as oe,b4 as ue,a8 as j,b5 as de,b6 as re,b7 as ie,g as $,$ as ce,o as h,i as S,w as s,u as t,l as U,U as _e,b3 as H,C as K,p as z,e as F,f as p,_ as P,h as E,c as T,ae as pe,Y as me,y as A,j as O,W as Q,b8 as ve,E as fe,b9 as be,ba as ge,B,d as G,I as J,J as W,K as ye,aq as we,G as xe,H as he,N as Y,q as M,s as X,bb as ke,bc as Ie,R as $e,b1 as Ce,ar as Ue,O as Ne,P as Oe,Q as Se,L as Ke,T as Pe,a1 as Te,a3 as je}from"./index-CH_iqGEu.js";import{_ as ze}from"./Operation.vue_vue_type_script_setup_true_lang-BNvC77tD.js";import{_ as Fe}from"./TableHead-Cb3b9_j1.js";import{_ as Be}from"./ExportOutlined-COSve7CZ.js";var De={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"};const Le=De;function q(l){for(var a=1;a<arguments.length;a++){var u=arguments[a]!=null?Object(arguments[a]):{},o=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(u).filter(function(n){return Object.getOwnPropertyDescriptor(u,n).enumerable}))),o.forEach(function(n){Re(l,n,u[n])})}return l}function Re(l,a,u){return a in l?Object.defineProperty(l,a,{value:u,enumerable:!0,configurable:!0,writable:!0}):l[a]=u,l}var D=function(a,u){var o=q({},a,u.attrs);return e(se,q({},o,{icon:Le}),null)};D.displayName="LockOutlined";D.inheritAttrs=!1;const Ve=D,x=v({data:[],loading:!1,selectedKeys:[]}),g=v({pageNum:1,pageSize:20,total:0,status:"0",userName:"",phonenumber:"",deptId:void 0}),k=v(!1);let Z={createBy:"",createTime:"",remark:"",userId:void 0,deptId:0,userName:"",nickName:"",email:"",phonenumber:"",sex:"0",avatar:"",password:"",status:"0",delFlag:"",loginIp:"",loginDate:"",roles:[],admin:!1,roleId:void 0,postIds:[],roleIds:[]};const d=v({...Z}),L=v([]),ee=v([]),Me=async()=>{d.value={...Z},await R(),console.log(L.value)},te=l=>{oe.confirm({title:"警告",content:"是否要删除用户",async onOk(){let a=[];l?a=[l]:a=x.value.selectedKeys;const{data:u}=await ue(a);await I(),j.success(u.msg)}})},R=async l=>{const{data:a}=await de(l||"");a.data&&(d.value=a.data,d.value.roleIds=a.roleIds,d.value.postIds=a.postIds),L.value=a.roles,ee.value=a.posts,k.value=!0},qe=()=>{k.value=!1,Me()},I=async()=>{x.value.loading=!0;const{data:l}=await re(g.value);x.value.data=l.rows,g.value.total=l.total,x.value.loading=!1},C=v([]),ae=async()=>{const{data:l}=await ie();l.data&&(C.value=l.data)},ne=(l,a)=>{for(const u of a){if(u.label.includes(l))return[u];if(u.children){const o=ne(l,u.children);if(o)return o}}return null},He=l=>(z("data-v-ab7556b3"),l=l(),F(),l),Ee=He(()=>p("h3",null,"用户部门",-1)),Ae=$({__name:"Dept",setup(l){const a=v([]),u=v(),o=v(""),n=v([]),r=()=>{let i=ne(o.value,C.value)||[];u.value=i},b=i=>{g.value.deptId=Number(i[0]),I()};return ce(C,async()=>{C.value.length===0&&await ae(),u.value=C.value,console.log(u.value)},{immediate:!0}),(i,c)=>{const y=_e,m=H,w=K;return h(),S(w,{class:"dept mr-4"},{default:s(()=>[Ee,e(y,{"allow-clear":"",value:t(o),"onUpdate:value":c[0]||(c[0]=f=>U(o)?o.value=f:null),placeholder:"请输入部门名称",onSearch:r,class:"my-8"},null,8,["value"]),e(m,{"tree-data":t(u),onSelect:b,selectable:"",checkable:!1,"expanded-keys":t(a),"onUpdate:expandedKeys":c[1]||(c[1]=f=>U(a)?a.value=f:null),"selected-keys":t(n),"onUpdate:selectedKeys":c[2]||(c[2]=f=>U(n)?n.value=f:null),blockNode:"","default-expand-all":!0,fieldNames:{title:"label",key:"id"}},null,8,["tree-data","expanded-keys","selected-keys"])]),_:1})}}}),Qe=P(Ae,[["__scopeId","data-v-ab7556b3"]]),V=l=>(z("data-v-8d715e8b"),l=l(),F(),l),Ge={class:"flex justify-between"},Je=V(()=>p("div",null,"角色分配",-1)),We={class:"flex justify-between"},Ye=V(()=>p("div",null,"岗位分配",-1)),Xe={class:"flex justify-between"},Ze=V(()=>p("div",null,"部门分配",-1)),et=$({__name:"Right",setup(l){const a=v(),u=v([]),o=()=>{d.value.deptId=u.value[0]||0};return E(async()=>{await ae(),a.value=C.value,u.value.push(d.value.deptId)}),(n,r)=>{const b=pe,i=H,c=me,y=K;return h(),T("div",null,[e(y,{title:"权限分配"},{default:s(()=>[e(c,{class:"w-100",direction:"vertical",size:20},{default:s(()=>[p("div",Ge,[Je,e(b,{value:t(d).roleIds,"onUpdate:value":r[0]||(r[0]=m=>t(d).roleIds=m),style:{width:"200px"},"field-names":{label:"roleName",value:"roleId"},allowClear:"",mode:"multiple",options:t(L)},null,8,["value","options"])]),p("div",We,[Ye,e(b,{value:t(d).postIds,"onUpdate:value":r[1]||(r[1]=m=>t(d).postIds=m),style:{width:"200px"},allowClear:"",mode:"multiple","field-names":{label:"postName",value:"postId"},options:t(ee)},null,8,["value","options"])]),p("div",Xe,[Ze,e(i,{style:{width:"200px"},"tree-data":t(a),selectable:"","selected-keys":t(u),"onUpdate:selectedKeys":r[2]||(r[2]=m=>U(u)?u.value=m:null),blockNode:"","default-expand-all":!0,fieldNames:{children:"children",title:"label",key:"id"},onSelect:o},null,8,["tree-data","selected-keys"])])]),_:1})]),_:1})])}}}),tt=P(et,[["__scopeId","data-v-8d715e8b"]]),at=l=>(z("data-v-21467d7c"),l=l(),F(),l),nt={class:"mb-8 px-12 py-8"},lt=at(()=>p("span",null,"编辑用户信息",-1)),st={class:"p-8",title:"基础信息"},ot=$({__name:"UserForm",setup(l){const a=v(!1),u=async()=>{a.value=!0;let o="";try{if(d.value.userId){const{data:n}=await ge(d.value);o=n.msg}else{const{data:n}=await be(d.value);o=n.msg}a.value=!1,j.success(o),k.value=!1,I()}catch{a.value=!1}};return(o,n)=>{const r=B,b=G,i=J,c=W,y=ye,m=we,w=xe,f=he,le=Y;return h(),S(le,{model:t(d),"label-align":"left",class:"form",onFinish:u,"label-col":{span:8}},{default:s(()=>[e(A,{w:"90%",h:"90%",visible:t(k),"onUpdate:visible":[n[8]||(n[8]=_=>U(k)?k.value=_:null),n[9]||(n[9]=_=>k.value=!1)],title:"用户中心"},{default:s(()=>[p("div",null,[p("div",nt,[e(b,{justify:"space-between"},{default:s(()=>[lt,e(r,{type:"primary",loading:t(a),htmlType:"submit"},{default:s(()=>[O("保存")]),_:1},8,["loading"])]),_:1})]),e(f,{gutter:12},{default:s(()=>[e(w,{span:12},{default:s(()=>[p("div",st,[e(c,{label:"昵称",name:"nickName",required:""},{default:s(()=>[e(i,{value:t(d).nickName,"onUpdate:value":n[0]||(n[0]=_=>t(d).nickName=_),focused:"",placeholder:"请输入昵称"},null,8,["value"])]),_:1}),e(c,{label:"账号",name:"userName",required:""},{default:s(()=>[e(i,{disabled:!1,value:t(d).userName,"onUpdate:value":n[1]||(n[1]=_=>t(d).userName=_),placeholder:"请输入账号"},null,8,["value"])]),_:1}),t(d).userId?Q("",!0):(h(),S(c,{key:0,label:"密码",required:""},{default:s(()=>[e(i,{type:"password",value:t(d).password,"onUpdate:value":n[2]||(n[2]=_=>t(d).password=_),placeholder:"请输入密码"},null,8,["value"])]),_:1})),e(c,{label:"手机号码",name:"phonenumber",rules:{len:11}},{default:s(()=>[e(i,{maxlength:11,value:t(d).phonenumber,"onUpdate:value":n[3]||(n[3]=_=>t(d).phonenumber=_),placeholder:"请输入手机号码"},null,8,["value"])]),_:1}),e(c,{label:"邮箱",name:"email"},{default:s(()=>[e(i,{value:t(d).email,"onUpdate:value":n[4]||(n[4]=_=>t(d).email=_),type:"email",placeholder:"请输入邮箱"},null,8,["value"])]),_:1}),e(c,{label:"性别",name:"sex"},{default:s(()=>[e(y,{value:t(d).sex,"onUpdate:value":n[5]||(n[5]=_=>t(d).sex=_),options:t(ve)},null,8,["value","options"])]),_:1}),e(c,{label:"状态",name:"status"},{default:s(()=>[e(y,{value:t(d).status,"onUpdate:value":n[6]||(n[6]=_=>t(d).status=_),options:t(fe)},null,8,["value","options"])]),_:1}),e(c,{label:"备注",name:"remark"},{default:s(()=>[e(m,{placeholder:"请输入备注信息","auto-size":{minRows:2,maxRows:6},value:t(d).remark,"onUpdate:value":n[7]||(n[7]=_=>t(d).remark=_)},null,8,["value"])]),_:1})])]),_:1}),e(w,{span:12},{default:s(()=>[e(tt)]),_:1})]),_:1})])]),_:1},8,["visible"])]),_:1},8,["model"])}}}),ut=P(ot,[["__scopeId","data-v-21467d7c"]]),dt=[{title:"用户名",dataIndex:"userName"},{title:"昵称",dataIndex:"nickName"},{title:"邮箱",dataIndex:"email"},{title:"登录IP",dataIndex:"loginIp"},{title:"电话",dataIndex:"phonenumber"},{title:"备注",dataIndex:"remark"},{title:"操作",dataIndex:"operation"}],rt=dt,N=v(!1),it=[{label:"删除用户",key:"delete",icon:M(X),async onClick(){te()}},{label:"修改密码",key:"update",icon:M(Ve),async onClick(){N.value=!0}}],ct=$({__name:"ChangePassword",setup(l){const a=v({password:""}),u=async()=>{const{data:n}=await ke(a.value.password,d.value.userId);j.success(n.msg),N.value=!1,a.value.password=""},o={min:6,max:16,type:"string",required:!0};return(n,r)=>{const b=Ie,i=W,c=B,y=Y,m=K;return h(),T("div",null,[e(A,{visible:t(N),"onUpdate:visible":r[1]||(r[1]=w=>U(N)?N.value=w:null),w:"300px",h:"200px",title:"修改密码"},{default:s(()=>[e(m,{bordered:!1},{default:s(()=>[e(y,{model:t(a),layout:"vertical",onSubmit:u},{default:s(()=>[e(i,{required:"",name:"password",label:"新的密码",rules:o},{default:s(()=>[e(b,{maxlength:16,allowClear:"",value:t(a).password,"onUpdate:value":r[0]||(r[0]=w=>t(a).password=w),placeholder:"请输入新的密码"},null,8,["value"])]),_:1}),e(c,{type:"primary",block:"",htmlType:"submit"},{default:s(()=>[O("确定")]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["visible"])])}}}),_t=P(ct,[["__scopeId","data-v-1a51911f"]]),pt={class:"flex-1"},mt={class:"mb-8 flex gc-8 system__subtitle"},vt={class:"flex justify-between"},ft={class:"flex gc-4"},bt={class:"flex gc-4 align-center"},gt=$({__name:"UserTableHead",setup(l){const a=async()=>{await Ue({url:"system/user/export",data:{pageNum:g.value.pageNum,pageSize:g.value.pageSize},fileName:"用户表",method:"POST"})};return(u,o)=>{const n=J,r=B,b=Ne,i=Oe,c=Se,y=Ke,m=Pe,w=Fe;return h(),T("div",null,[e(w,{title:"用户列表"},{default:s(()=>[p("div",pt,[p("div",mt,[p("div",null,[O(" 用户名 "),e(n,{"allow-clear":"",style:{width:"180px"},value:t(g).userName,"onUpdate:value":o[0]||(o[0]=f=>t(g).userName=f)},null,8,["value"])]),p("div",null,[O(" 手机号 "),e(n,{"allow-clear":"",style:{width:"180px"},value:t(g).phonenumber,"onUpdate:value":o[1]||(o[1]=f=>t(g).phonenumber=f)},null,8,["value"])]),e(r,{type:"primary",onClick:t(I)},{default:s(()=>[O("搜索")]),_:1},8,["onClick"])]),p("div",vt,[p("div",ft,[e(i,{title:"新建用户"},{default:s(()=>[e(r,{type:"primary",onClick:t(qe)},{default:s(()=>[e(b)]),_:1},8,["onClick"])]),_:1}),e(i,{title:"刷新"},{default:s(()=>[e(r,{onClick:t(I)},{default:s(()=>[e(t($e))]),_:1},8,["onClick"])]),_:1}),e(i,{title:"编辑"},{default:s(()=>[e(r,{onClick:o[2]||(o[2]=f=>t(R)()),disabled:t(x).selectedKeys.length!==1},{default:s(()=>[e(c)]),_:1},8,["disabled"])]),_:1}),e(i,{title:"导出"},{default:s(()=>[e(r,{onClick:a},{default:s(()=>[e(t(Be))]),_:1})]),_:1})]),p("div",bt,[e(y,{options:t(Ce)("启用","禁用"),value:t(g).status,"onUpdate:value":o[3]||(o[3]=f=>t(g).status=f),onChange:t(I)},null,8,["options","value","onChange"]),e(m,{type:"vertical"}),e(r,{onClick:o[4]||(o[4]=f=>t(te)()),danger:""},{default:s(()=>[e(t(X))]),_:1})])])])]),_:1})])}}}),yt={class:"flex-1"},wt=$({__name:"UserTable",setup(l){const a=r=>{d.value=r};E(()=>{I()});const u=r=>{x.value.selectedKeys=r.map(b=>Number(b))},o=r=>({onClick(){x.value.selectedKeys=[Number(r.userId)]}}),n=(r,b,i)=>{g.value.pageNum=r.current||0,g.value.pageSize=r.pageSize||0,!(i instanceof Array)&&i.columnKey&&(g.value.orderByColumn=`${i.columnKey}`)};return(r,b)=>{const i=je,c=K;return h(),T("div",yt,[e(gt),e(c,{class:"mt-8"},{default:s(()=>[e(i,{columns:t(Te)(t(rt)),dataSource:t(x).data,loading:t(x).loading,onChange:n,sticky:"","row-selection":{selectedRowKeys:t(x).selectedKeys,onChange:u},customRow:o,rowKey:"userId"},{bodyCell:s(({column:y,record:m})=>[y.dataIndex==="operation"?(h(),S(ze,{key:0,loading:t(x).loading,onOpenChange:w=>a(m),onOnClick:w=>t(R)(m.userId),items:t(it)},null,8,["loading","onOpenChange","onOnClick","items"])):Q("",!0)]),_:1},8,["columns","dataSource","loading","row-selection"])]),_:1}),e(_t)])}}}),$t=$({__name:"index",setup(l){return(a,u)=>{const o=G,n=K;return h(),S(n,{class:"system__module card__container","body-style":{padding:"0",height:"100%"}},{default:s(()=>[e(o,{class:"h-100 flex-1"},{default:s(()=>[e(Qe),e(wt),e(ut)]),_:1})]),_:1})}}});export{$t as default};
