import{a as e,A as Y,r as x,aK as de,d as $,v as X,a1 as ce,o as _,c as b,e as P,u as n,i as S,x as R,s as ie,aJ as pe,N as _e,aL as me,P as F,aM as fe,aN as ve,I as ge,J as be,f as y,_ as L,w as l,y as H,z as A,W as J,C as Q,aO as ye,b as he,ai as j,aw as T,au as we,ax as xe,av as ke,S as Z,aP as Ie,am as $e,aQ as Ce,aR as Oe,L as B,aj as Ue,ak as Ne,ag as Pe,ah as Se,F as ee,K as U,aS as Re,B as te,aT as Ee,aU as De,p as Fe,aV as Le,j as ne,l as ze,m as je,n as ae,R as Te,q as Be,aG as qe,a5 as Me,a6 as Ve,a3 as Ke}from"./index-HxNFWFwR.js";import{_ as He}from"./FormFooter-5NEaOLHv.js";import Ae from"./dept-CzqcYO7G.js";import Je from"./role-9JDBhlCW.js";import{_ as Qe}from"./TableHead-D-Q4jVMf.js";var We={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"};const Ge=We;function W(o){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?Object(arguments[a]):{},t=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(t=t.concat(Object.getOwnPropertySymbols(s).filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable}))),t.forEach(function(d){Ye(o,d,s[d])})}return o}function Ye(o,a,s){return a in o?Object.defineProperty(o,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):o[a]=s,o}var q=function(a,s){var t=W({},a,s.attrs);return e(Y,W({},t,{icon:Ge}),null)};q.displayName="ExportOutlined";q.inheritAttrs=!1;const Xe=q;var Ze={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"};const et=Ze;function G(o){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?Object(arguments[a]):{},t=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(t=t.concat(Object.getOwnPropertySymbols(s).filter(function(d){return Object.getOwnPropertyDescriptor(s,d).enumerable}))),t.forEach(function(d){tt(o,d,s[d])})}return o}function tt(o,a,s){return a in o?Object.defineProperty(o,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):o[a]=s,o}var M=function(a,s){var t=G({},a,s.attrs);return e(Y,G({},t,{icon:et}),null)};M.displayName="LockOutlined";M.inheritAttrs=!1;const nt=M,O=x([]),at=async()=>{const{data:o}=await de();o.data&&(O.value=o.data)},se=(o,a,s=[])=>{for(const t of a){if(t.id===o)return[...s,t.id];if(t.children){const d=se(o,t.children,[...s,t.id]);if(d)return d}}return s},oe=(o,a)=>{for(const s of a){if(s.label.includes(o))return[s];if(s.children){const t=oe(o,s.children);if(t)return t}}return null},le=$({__name:"Department",props:{id:{},allowSelect:{type:Boolean}},emits:["search","select"],setup(o,{emit:a}){const s=x([]),t=x(),d=x(""),r=x([]),m=a,c=o,f=()=>{let g=oe(d.value,O.value)||[];t.value=g,m("search",g)},h=g=>{m("select",g)};return X(()=>{c.id&&(r.value=[c.id])}),ce(O,async()=>{O.value.length===0&&await at(),t.value=O.value,c.id&&(s.value=se(c.id,O.value)||[])},{immediate:!0}),(g,v)=>{const p=ie,i=pe;return _(),b("div",null,[g.allowSelect?(_(),P(p,{key:0,"allow-clear":"",value:n(d),"onUpdate:value":v[0]||(v[0]=k=>S(d)?d.value=k:null),placeholder:"Please enter department name",onSearch:f},null,8,["value"])):R("",!0),e(i,{class:"mt-8","tree-data":n(t),selectable:"","expanded-keys":n(s),"onUpdate:expandedKeys":v[1]||(v[1]=k=>S(s)?s.value=k:null),"selected-keys":n(r),"onUpdate:selectedKeys":v[2]||(v[2]=k=>S(r)?r.value=k:null),blockNode:"","default-expand-all":!0,fieldNames:{children:"children",title:"label",key:"id"},onSelect:h},null,8,["tree-data","expanded-keys","selected-keys"])])}}}),I=x({data:[],loading:!1,selectedKeys:[]}),w=x({pageNum:1,pageSize:20,total:0,status:"",userName:"",phonenumber:"",deptId:void 0}),re=o=>{_e.confirm({title:"Whether to perform an operation",content:"The system may be affected",async onOk(){let a=[];o?a=[o]:a=I.value.selectedKeys;const{data:s}=await me(a);await N(),F.success(s.msg)}})},V=async o=>{const{data:a}=await fe(o||"");a.data&&(u.value=a.data,u.value.roleIds=a.roleIds,u.value.postIds=a.postIds),D.value=a.roles,z.value=a.posts,C.value=!0},st=()=>{C.value=!1,ot()},N=async()=>{I.value.loading=!0;const{data:o}=await ve(w.value);I.value.data=o.rows,w.value.total=o.total,I.value.loading=!1},C=x(!1);let ue={createBy:"",createTime:"",remark:"",userId:void 0,deptId:0,userName:"",nickName:"",email:"",phonenumber:"",sex:"0",avatar:"",password:"",status:"0",delFlag:"",loginIp:"",loginDate:"",roles:[],admin:!1,roleId:void 0,postIds:[],roleIds:[]};const u=x({...ue}),D=x([]),z=x([]),ot=async()=>{u.value={...ue},await V(),console.log(D.value)},lt=o=>(ge("data-v-6ad14f8a"),o=o(),be(),o),rt={class:"dept p-8"},ut=lt(()=>y("h3",{class:"text-16 text-bold mb-8"},"Department",-1)),dt=$({__name:"Dept",setup(o){const a=s=>{w.value.deptId=Number(s[0]),N()};return(s,t)=>(_(),b("div",rt,[ut,e(le,{"allow-select":"",onSelect:a,id:n(u).deptId},null,8,["id"])]))}}),ct=L(dt,[["__scopeId","data-v-6ad14f8a"]]),it={class:"right-list"},pt={key:0},_t=["onClick"],mt=["src"],ft={class:"text-12 title"},vt={key:0,class:"checked"},gt={class:"right-list post"},bt={key:0},yt=["onClick"],ht=["src"],wt={class:"text-12 title"},xt={key:0,class:"checked"},kt=$({__name:"Right",setup(o){const a=t=>{u.value.roleIds.includes(t.roleId)?u.value.roleIds=u.value.roleIds.filter(d=>d!==t.roleId):u.value.roleIds.push(t.roleId)},s=t=>{u.value.postIds.includes(t.postId)?u.value.postIds=u.value.postIds.filter(d=>d!==t.postId):u.value.postIds.push(t.postId)};return(t,d)=>{const r=ye,m=he,c=j,f=T,h=we,g=xe,v=ke;return _(),b("div",null,[e(f,{title:"权限分配"},{default:l(()=>[e(v,null,{default:l(()=>[e(h,{key:"role",tab:"Role"},{default:l(()=>[e(f,{"body-style":{padding:0},bordered:!1},{default:l(()=>[e(c,{"wrapper-col":{span:24},required:"",name:"roleIds"},{default:l(()=>[y("div",it,[n(D).length>0?(_(),b("ul",pt,[(_(!0),b(H,null,A(n(D),(p,i)=>(_(),b("li",{key:i,class:J({active:n(u).roleIds.includes(p.roleId)}),onClick:k=>a(p)},[y("img",{src:n(Je),width:"32"},null,8,mt),y("div",ft,Q(p.roleName),1),n(u).roleIds.includes(p.roleId)?(_(),b("div",vt,[e(r,{style:{color:"#19a119"}})])):R("",!0)],10,_t))),128))])):(_(),P(m,{key:1}))])]),_:1})]),_:1})]),_:1}),e(h,{key:"post",tab:"Post"},{default:l(()=>[e(f,{"body-style":{padding:0},bordered:!1},{default:l(()=>[e(c,{"wrapper-col":{span:24},required:"",name:"postIds"},{default:l(()=>[y("div",gt,[n(z).length>0?(_(),b("ul",bt,[(_(!0),b(H,null,A(n(z),(p,i)=>(_(),b("li",{key:i,class:J({active:n(u).postIds.includes(p.postId)}),onClick:k=>s(p)},[y("img",{src:n(Ae),width:"32"},null,8,ht),y("div",wt,Q(p.postName),1),n(u).postIds.includes(p.postId)?(_(),b("div",xt,[e(g,{style:{color:"#19a119"}})])):R("",!0)],10,yt))),128))])):(_(),P(m,{key:1}))])]),_:1})]),_:1})]),_:1}),e(h,{key:"Department",tab:"Department"},{default:l(()=>[e(f,{"body-style":{padding:0,maxHeight:"550px",overflowY:"auto"},bordered:!1},{default:l(()=>[e(c,{"wrapper-col":{span:24},class:"mb-0"},{default:l(()=>[e(le,{id:n(u).deptId},null,8,["id"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}}}),It=L(kt,[["__scopeId","data-v-961fea43"]]),$t={class:"flex-1 p-8 h-100 flex flex-col"},Ct=$({__name:"UserForm",setup(o){const a=async()=>{let s="";if(u.value.userId){const{data:t}=await Oe(u.value);s=t.msg}else{const{data:t}=await Ce(u.value);s=t.msg}F.success(s),C.value=!1};return(s,t)=>{const d=B,r=j,m=Ue,c=Ne,f=T,h=Pe,g=Se,v=He,p=ee;return _(),P(p,{model:n(u),"label-align":"left",class:"form",onFinish:a,"label-col":{span:8}},{default:l(()=>[e(Z,{w:"90%",h:"90%",visible:n(C),"onUpdate:visible":[t[8]||(t[8]=i=>S(C)?C.value=i:null),t[9]||(t[9]=i=>C.value=!1)],title:"Menu config"},{default:l(()=>[y("div",$t,[e(g,{gutter:12,class:"flex-1"},{default:l(()=>[e(h,{span:12},{default:l(()=>[e(f,{title:"Base info"},{default:l(()=>[e(r,{label:"Nickname",name:"nickName",required:""},{default:l(()=>[e(d,{value:n(u).nickName,"onUpdate:value":t[0]||(t[0]=i=>n(u).nickName=i),focused:"",placeholder:"Please enter nickname"},null,8,["value"])]),_:1}),e(r,{label:"Username",name:"userName",required:""},{default:l(()=>[e(d,{value:n(u).userName,"onUpdate:value":t[1]||(t[1]=i=>n(u).userName=i),placeholder:"Please enter username"},null,8,["value"])]),_:1}),n(u).userId?R("",!0):(_(),P(r,{key:0,label:"Password",name:"password",required:""},{default:l(()=>[e(d,{type:"password",value:n(u).password,"onUpdate:value":t[2]||(t[2]=i=>n(u).password=i),placeholder:"Please enter password"},null,8,["value"])]),_:1})),e(r,{label:"Phone",name:"phonenumber",required:"",rules:{len:11}},{default:l(()=>[e(d,{maxlength:11,value:n(u).phonenumber,"onUpdate:value":t[3]||(t[3]=i=>n(u).phonenumber=i),placeholder:"Please enter phone number"},null,8,["value"])]),_:1}),e(r,{label:"Email",name:"email",required:""},{default:l(()=>[e(d,{value:n(u).email,"onUpdate:value":t[4]||(t[4]=i=>n(u).email=i),type:"email",placeholder:"Please enter email"},null,8,["value"])]),_:1}),e(r,{label:"Sex",name:"sex",required:""},{default:l(()=>[e(m,{value:n(u).sex,"onUpdate:value":t[5]||(t[5]=i=>n(u).sex=i),options:n(Ie)},null,8,["value","options"])]),_:1}),e(r,{label:"Status",name:"status",required:""},{default:l(()=>[e(m,{value:n(u).status,"onUpdate:value":t[6]||(t[6]=i=>n(u).status=i),options:n($e)},null,8,["value","options"])]),_:1}),e(r,{label:"Remark",name:"remark"},{default:l(()=>[e(c,{"auto-size":{minRows:2,maxRows:6},value:n(u).remark,"onUpdate:value":t[7]||(t[7]=i=>n(u).remark=i)},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(h,{span:12},{default:l(()=>[e(It)]),_:1})]),_:1}),e(v)])]),_:1},8,["visible"])]),_:1},8,["model"])}}}),Ot=L(Ct,[["__scopeId","data-v-5bc0a9fe"]]),E=x(!1),Ut=$({__name:"ChangePassword",setup(o){const a=x({password:""}),s=async()=>{const{data:d}=await Re(a.value.password,u.value.userId);F.success(d.msg)},t={min:6,max:16,type:"string",required:!0};return(d,r)=>{const m=B,c=j,f=te,h=ee,g=T;return _(),b("div",null,[e(Z,{visible:n(E),"onUpdate:visible":r[1]||(r[1]=v=>S(E)?E.value=v:null),w:"300px",h:"200px",title:"Change password"},{default:l(()=>[e(g,{bordered:!1},{default:l(()=>[e(h,{model:n(a),layout:"vertical",onSubmit:s},{default:l(()=>[e(c,{required:"",name:"password",label:"New password",rules:t},{default:l(()=>[e(m,{maxlength:16,value:n(a).password,"onUpdate:value":r[0]||(r[0]=v=>n(a).password=v),type:"password"},null,8,["value"])]),_:1}),e(f,{type:"primary",block:"",htmlType:"submit"},{default:l(()=>[U("Confirm")]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["visible"])])}}}),Nt=L(Ut,[["__scopeId","data-v-392cc441"]]),Pt=[{title:"Username",dataIndex:"userName"},{title:"Nickname",dataIndex:"nickName"},{title:"Email",dataIndex:"email"},{title:"Login ip",dataIndex:"loginIp"},{title:"Phone",dataIndex:"phonenumber"},{title:"remark",dataIndex:"remark"},{title:"Operation",dataIndex:"operation"}],St=Pt,Rt=async(o,a,s="file")=>{const t=Ee(),d=De();try{const m=await(await fetch(t.$state.developer.baseURL+o,{method:"POST",body:a,headers:{Authorization:`Bearer ${d.$state.token}`}})).blob(),c=window.URL.createObjectURL(m),f=document.createElement("a");f.href=c,f.download=s,f.click(),window.URL.revokeObjectURL(c)}catch{F.warning("Error exporting file!")}},Et={class:"flex-1"},Dt={class:"mb-8 flex gc-8 text-999"},Ft={class:"flex justify-between"},Lt={class:"flex gc-4"},zt={class:"flex gc-4 align-center"},jt=$({__name:"UserTableHead",setup(o){const a=async()=>{await Rt("system/user/export",{pageNum:w.value.pageNum,pageSize:w.value.pageSize})};return(s,t)=>{const d=B,r=te,m=ze,c=je,f=ae,h=Te,g=Be,v=Qe;return _(),b("div",null,[e(v,{title:"User list"},{default:l(()=>[y("div",Et,[y("div",Dt,[y("div",null,[U(" Username "),e(d,{"allow-clear":"",style:{width:"180px"},value:n(w).userName,"onUpdate:value":t[0]||(t[0]=p=>n(w).userName=p)},null,8,["value"])]),y("div",null,[U(" Phone "),e(d,{"allow-clear":"",style:{width:"180px"},value:n(w).phonenumber,"onUpdate:value":t[1]||(t[1]=p=>n(w).phonenumber=p)},null,8,["value"])]),e(r,{type:"primary",onClick:n(N)},{default:l(()=>[U("Search")]),_:1},8,["onClick"])]),y("div",Ft,[y("div",Lt,[e(c,{title:"Create"},{default:l(()=>[e(r,{type:"primary",onClick:n(st)},{default:l(()=>[e(m)]),_:1},8,["onClick"])]),_:1}),e(c,{title:"Refresh"},{default:l(()=>[e(r,{onClick:n(N)},{default:l(()=>[e(n(Fe))]),_:1},8,["onClick"])]),_:1}),e(c,{title:"Edit"},{default:l(()=>[e(r,{onClick:t[2]||(t[2]=p=>n(V)()),disabled:n(I).selectedKeys.length!==1},{default:l(()=>[e(f)]),_:1},8,["disabled"])]),_:1}),e(c,{title:"Export"},{default:l(()=>[e(r,{onClick:a},{default:l(()=>[e(n(Xe))]),_:1})]),_:1})]),y("div",zt,[e(h,{options:n(Le)("Normal","Disabled"),value:n(w).status,"onUpdate:value":t[3]||(t[3]=p=>n(w).status=p),onChange:n(N)},null,8,["options","value","onChange"]),e(g,{type:"vertical"}),e(r,{onClick:t[4]||(t[4]=p=>n(re)()),danger:""},{default:l(()=>[e(n(ne))]),_:1})])])])]),_:1})])}}}),Tt={class:"flex-1 pt-8 px-8"},Bt=$({__name:"UserTable",setup(o){X(()=>{N()});const a=r=>{I.value.selectedKeys=r.map(m=>Number(m))},s=r=>({onClick(){I.value.selectedKeys=[Number(r.userId)]}}),t=(r,m,c)=>{w.value.pageNum=r.current||0,w.value.pageSize=r.pageSize||0,!(c instanceof Array)&&c.columnKey&&(w.value.orderByColumn=`${c.columnKey}`)},d=St.map(r=>(r.ellipsis=!0,r.key=`${r.dataIndex}`,r));return(r,m)=>{const c=ae,f=qe,h=nt,g=Me,v=Ve,p=Ke;return _(),b("div",Tt,[e(jt),e(p,{class:"px-12",columns:n(d),dataSource:n(I).data,loading:n(I).loading,onChange:t,sticky:"","row-selection":{selectedRowKeys:n(I).selectedKeys,onChange:a},customRow:s,rowKey:"userId"},{bodyCell:l(({column:i,record:k})=>[i.dataIndex==="operation"?(_(),P(v,{key:0,onClick:K=>n(V)(k.userId),trigger:"click"},{overlay:l(()=>[e(g,null,{default:l(()=>[e(f,{onClick:K=>n(re)(k.userId)},{icon:l(()=>[e(n(ne))]),default:l(()=>[U(" Delete ")]),_:2},1032,["onClick"]),e(f,{onClick:m[0]||(m[0]=K=>E.value=!0)},{icon:l(()=>[e(h)]),default:l(()=>[U(" Change password ")]),_:1})]),_:2},1024)]),default:l(()=>[e(c)]),_:2},1032,["onClick"])):R("",!0)]),_:1},8,["columns","dataSource","loading","row-selection"]),e(Nt)])}}}),qt={class:"system-module flex"},Jt=$({__name:"index",setup(o){return(a,s)=>(_(),b("div",qt,[e(ct),e(Bt),e(Ot)]))}});export{Jt as default};
