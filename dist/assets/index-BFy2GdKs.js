import{a as N,ar as ne,a8 as H,r as C,q as ae,s as E,v as W,an as J,g as D,o as i,i as v,w as n,b as e,f,t as q,u as t,Z as oe,d as A,C as F,x as se,y as le,l as ue,j as I,U as ie,aC as _e,J as re,I as Z,aq as ce,ae as de,B as K,N as pe,as as me,c as S,F as V,k as G,at as z,a$ as fe,K as ge,O as be,P as ve,Q as ye,R as we,V as he,a7 as ke,ak as xe,au as Ce,bd as Y,be as Q,n as $e,_ as Ie,a1 as Se,W as Oe,bf as Ue,aA as Re,a4 as Ne,a5 as De,aU as Fe,a3 as Be,h as Te}from"./index-_mG2u1vj.js";import{g as Le}from"./dict.data-v0oxLcIb.js";import{F as ze}from"./Field-BJGw4_X2.js";import{O as je,A as qe}from"./OrderedListOutlined-D1Afeb5p.js";import{_ as Ae}from"./ExportOutlined-DAgkJx-d.js";const We=a=>N.get("system/website/list",{params:a}),Ee=a=>N.get(`system/website/${a}`),Ke=a=>N.post("system/website",a),Ve=a=>N.put("/system/website",a),Xe=a=>N.delete(`system/website/${a.join(",")}`),Me=async a=>{await ne({url:"system/website/export",data:void 0,fileName:"TEST.xls",method:"POST"}),H.success("成功下载")},Pe=a=>N.get(`system/website/siteInfo/${a}`),R=C(!1),ee={websiteId:0,name:"",url:"",createTime:null,description:"",type:"",updateTime:null},r=C({...ee}),Qe=()=>{r.value={...ee}},He={name:[{required:!0,trigger:"change"}],url:[{required:!0,trigger:"change"}],createTime:[{required:!1,trigger:"change"}],type:[{required:!0,trigger:"change"}]},y=C({rowKey:"websiteId",data:[],loading:!1,moduleName:"website"}),j=C("card"),d=C({pageNum:1,pageSize:20,total:0,name:"",url:"",type:"image"}),x=C([]);ae(E);const k=async()=>{y.value.loading=!0;const{data:a}=await We(d.value);y.value.data=a.rows,d.value.total=a.total,y.value.loading=!1},te=async a=>{let l=a||x.value[0];y.value.loading=!0;const{data:c}=await Ee(l);c.data&&(r.value=c.data,R.value=!0),y.value.loading=!1},Je=async()=>{Qe(),R.value=!0},X=async a=>{let l=a?[a]:x.value;await W(Xe,l),await k(),x.value=[]},Ze=()=>Me({pageNum:d.value.pageNum,pageSize:d.value.pageSize}),Ge=a=>{var c;const l=J();return a!==((c=l.$state.userInfo)==null?void 0:c.userId)},Ye=f("span",null,"已选:",-1),et=D({__name:"AXFooter",setup(a){const l=(c,o)=>{d.value.pageNum=c,d.value.pageSize=o,console.log(c,o),k()};return(c,o)=>{const m=oe,u=A,s=F;return i(),v(s,{bordered:!1,bodyStyle:{padding:"4px 12px"},class:"card__footer"},{default:n(()=>[e(u,{justify:"space-between",align:"center"},{default:n(()=>[f("div",null,[Ye,f("span",null,"（"+q(t(x).length)+"）",1)]),e(m,{total:t(d).total,current:t(d).pageNum,"page-size":t(d).pageSize,"show-size-changer":"",onChange:l,"show-quick-jumper":"","show-less-items":""},null,8,["total","current","page-size"])]),_:1})]),_:1})}}}),M=C(),tt=async()=>{const{data:a}=await Le("website_type");a.data&&(M.value=se(a.data))},nt=f("div",{class:"system__subtitle"},"http(s)://",-1),at={class:"system__subtitle mt-4"},ot=D({__name:"AXForm",setup(a){const l=C(!1),c=u=>{try{const s=new URL(u).hostname,_=s.split(".");return _.length>2?_.slice(-2).join("."):s}catch(s){return console.error("Invalid URL:",s),""}},o=async()=>{if(r.value.url){let u=c(r.value.url);try{const{data:s}=await Pe(u);s.data&&u&&(r.value.description=s.data.description,r.value.name=s.data.title)}catch{H.warn("获取失败，请手动填写信息")}}},m=async()=>{l.value=!0,r.value.websiteId?await W(Ve,r.value):await W(Ke,r.value),await k(),l.value=!1,R.value=!1};return(u,s)=>{const _=ie,w=_e,g=re,h=Z,B=ce,O=de,T=K,L=F,$=pe;return i(),v($,{rules:t(He),model:t(r),onFinish:m,"wrapper-col":{span:8,offset:1},"label-col":{span:4,offset:4}},{default:n(()=>[e(le,{title:"网页收藏",visible:t(R),"onUpdate:visible":s[4]||(s[4]=p=>ue(R)?R.value=p:null)},{default:n(()=>[e(L,{title:"编辑/新增"},{extra:n(()=>[e(T,{htmlType:"submit",type:"primary",loading:t(l),block:""},{default:n(()=>[I("保存")]),_:1},8,["loading"])]),default:n(()=>[e(g,{label:"网页URL",name:"url"},{default:n(()=>[e(_,{placeholder:"请输入网页URL",value:t(r).url,"onUpdate:value":s[0]||(s[0]=p=>t(r).url=p),onSearch:o},{prefix:n(()=>[nt]),_:1},8,["value"]),f("div",at,[e(w),I(" 点击搜索能自动获取网页信息 ")])]),_:1}),e(g,{label:"网页名称",name:"name"},{default:n(()=>[e(h,{placeholder:"请输入网页名称",value:t(r).name,"onUpdate:value":s[1]||(s[1]=p=>t(r).name=p)},null,8,["value"])]),_:1}),e(g,{label:"网页描述",name:"description"},{default:n(()=>[e(B,{placeholder:"请输入网页描述","auto-size":{minRows:5},maxlength:140,"show-count":"",value:t(r).description,"onUpdate:value":s[2]||(s[2]=p=>t(r).description=p)},null,8,["value"])]),_:1}),e(g,{label:"网页类型",name:"type"},{default:n(()=>[e(O,{value:t(r).type,"onUpdate:value":s[3]||(s[3]=p=>t(r).type=p),class:"w-100",placeholder:"请选择网页类型","allow-clear":"",onChange:t(k),options:t(M)},null,8,["value","onChange","options"])]),_:1})]),_:1})]),_:1},8,["visible"])]),_:1},8,["rules","model"])}}}),P=C([{title:"网页名称",dataIndex:"name"},{title:"网页URL",dataIndex:"url"},{title:"网页描述",dataIndex:"description"},{title:"网页类型",dataIndex:"type"},{title:"来源",dataIndex:"from"}]),st=f("h3",{class:"text-14"},"网页收藏列表",-1),lt=D({__name:"AXHead",setup(a){const l=()=>{d.value.pageNum=1,k()};return(c,o)=>{const m=fe,u=ge,s=Z,_=K,w=A,g=be,h=ve,B=ye,O=we,T=Ae,L=E,$=he,p=F,U=me("perm");return i(),v(p,{class:"table__head"},{title:n(()=>[st]),default:n(()=>[e(w,{class:"mb-12",wrap:"wrap",justify:"space-between"},{default:n(()=>[f("div",null,[e(u,{value:t(d).type,"onUpdate:value":o[0]||(o[0]=b=>t(d).type=b),placeholder:"请选择网页类型","allow-clear":"",onChange:l},{default:n(()=>[(i(!0),S(V,null,G(t(M),b=>(i(),v(m,{value:b.value},{default:n(()=>[I(q(b.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),e(w,{gap:12},{default:n(()=>[f("div",null,[e(s,{onBlur:t(k),value:t(d).name,"onUpdate:value":o[1]||(o[1]=b=>t(d).name=b),style:{width:"160px"},placeholder:"请输入网页名称","allow-clear":""},null,8,["onBlur","value"])]),f("div",null,[e(s,{onBlur:t(k),value:t(d).url,"onUpdate:value":o[2]||(o[2]=b=>t(d).url=b),style:{width:"160px"},placeholder:"请输入网页URL","allow-clear":""},null,8,["onBlur","value"])]),e(_,{type:"primary",onClick:t(k)},{default:n(()=>[I("搜索")]),_:1},8,["onClick"])]),_:1})]),_:1}),e(w,{justify:"space-between",align:"center"},{default:n(()=>[e(w,{justify:"space-between",align:"center"},{default:n(()=>[e(w,{align:"center",gap:4},{default:n(()=>[z((i(),S("div",null,[e(h,{title:"新建"},{default:n(()=>[e(_,{type:"primary",onClick:t(Je)},{default:n(()=>[e(g)]),_:1},8,["onClick"])]),_:1})])),[[U,"system:website:add"]]),z((i(),S("div",null,[e(h,{title:"编辑 ( 双击 )"},{default:n(()=>[e(_,{type:"link",onClick:o[3]||(o[3]=b=>t(te)()),disabled:t(x).length!==1},{default:n(()=>[e(B)]),_:1},8,["disabled"])]),_:1})])),[[U,"system:website:edit"]]),e(h,{title:"刷新"},{default:n(()=>[e(_,{type:"link",onClick:t(k)},{default:n(()=>[e(O)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),e(w,null,{default:n(()=>[e(h,{title:"导出"},{default:n(()=>[e(_,{type:"link",onClick:t(Ze)},{default:n(()=>[e(T)]),_:1},8,["onClick"])]),_:1}),z((i(),S("div",null,[e($,{title:"确定要删除吗",disabled:t(x).length===0,placement:"bottomRight",onConfirm:o[4]||(o[4]=b=>t(X)())},{default:n(()=>[e(h,{title:"批量删除"},{default:n(()=>[e(_,{danger:"",type:"link",disabled:t(x).length===0},{default:n(()=>[e(L)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["disabled"])])),[[U,"system:website:remove"]]),e(ze,{columns:t(P),"module-name":t(y).moduleName},null,8,["columns","module-name"]),f("div",null,[t(j)==="table"?(i(),v(h,{key:0,title:"卡片模式",onClick:o[5]||(o[5]=b=>j.value="card")},{default:n(()=>[e(_,{type:"link"},{default:n(()=>[e(t(je))]),_:1})]),_:1})):(i(),v(h,{key:1,title:"表格模式",onClick:o[6]||(o[6]=b=>j.value="table")},{default:n(()=>[e(_,{type:"link"},{default:n(()=>[e(t(qe))]),_:1})]),_:1}))])]),_:1})]),_:1})]),_:1})}}}),ut=ke(()=>{let a=[];return y.value.data.map((l,c)=>{let o=[];P.value.forEach((m,u)=>{const s=m.title,_=l[m.dataIndex];m.dataIndex!=="operation"&&o.push({label:s,value:_})}),a.push({id:l.websiteId,items:o,raw:l})}),a}),it=["onDblclick"],_t=["src"],rt={class:"site-title"},ct={class:"text-right"},dt={class:"system__subtitle"},pt=D({__name:"AXCard",setup(a){const l=C();function c(o,m="http"){return o.startsWith("http://")||o.startsWith("https://")?o:`${m}://${o}/`}return xe(()=>{Ce(l,ut.value,{animation:200,onUpdate(o){}})}),(o,m)=>{const u=K,s=A,_=$e,w=F;return i(),v(w,{class:"table__card"},{default:n(()=>[z(f("ul",{class:"table_card_list flex-1",ref_key:"cardRef",ref:l},[(i(!0),S(V,null,G(t(y).data,g=>(i(),S("li",{draggable:!0,key:g.websiteId,onDblclick:h=>t(Y)(g.url)},[f("img",{src:`https://favicon.qqsuu.cn/${g.url}`,width:"36",height:"36"},null,8,_t),e(s,{class:"flex-1",vertical:"",gap:2},{default:n(()=>[e(s,{justify:"space-between"},{default:n(()=>[f("div",rt,q(g.name),1),f("div",ct,[e(u,{target:"_blank",href:c(g.url),type:"link",class:"open"},{default:n(()=>[I(" 打开 ")]),_:2},1032,["href"])])]),_:2},1024),f("div",dt,q(g.description),1)]),_:2},1024)],40,it))),128))],512),[[Q,t(y).data.length>0]]),z(e(_,null,null,512),[[Q,t(y).data.length===0]])]),_:1})}}}),mt=Ie(pt,[["__scopeId","data-v-d22fcd00"]]),ft=D({__name:"AXTable",setup(a){const l=J(),c=u=>{r.value=u},o=u=>({onClick(){x.value=[u.websiteId]},onDblclick(){te(u.websiteId)}}),m=(u,s,_)=>{d.value.pageNum=u.current,d.value.pageSize=u.pageSize};return(u,s)=>{const _=Ue,w=E,g=Re,h=Ne,B=De,O=Fe,T=Be,L=F;return i(),v(L,{style:{boxShadow:"none"},"body-style":{padding:"0"}},{default:n(()=>[e(T,{onChange:m,"table-layout":"fixed",sticky:"","row-selection":{selectedRowKeys:t(x),onChange:$=>x.value=$},loading:t(y).loading,bordered:!1,pagination:!1,customRow:o,rowKey:t(y).rowKey,columns:t(Se)(t(P)),"data-source":t(y).data},{bodyCell:n(({column:$,record:p})=>{var U;return[$.key==="operation"?(i(),v(B,{key:0,trigger:"click",onClick:b=>t(Y)(p.url),onOpenChange:b=>c(p)},{overlay:n(()=>[e(h,null,{default:n(()=>[e(g,{disabled:t(Ge)(p.userId),onClick:b=>t(X)(p.userId)},{icon:n(()=>[e(w)]),default:n(()=>[I(" 删除 ")]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),default:n(()=>[e(_)]),_:2},1032,["onClick","onOpenChange"])):$.key==="from"?(i(),S(V,{key:1},[p.userId===((U=t(l).$state.userInfo)==null?void 0:U.userId)?(i(),v(O,{key:0,bordered:!1,color:"green"},{default:n(()=>[I(" 自己 ")]),_:1})):(i(),v(O,{key:1,color:"orange",bordered:!1},{default:n(()=>[I("超管")]),_:1}))],64)):Oe("",!0)]}),_:1},8,["row-selection","loading","rowKey","columns","data-source"])]),_:1})}}}),gt={class:"data__content"},kt=D({__name:"index",setup(a){return Te(async()=>{await k(),await tt()}),(l,c)=>{const o=A,m=F;return i(),v(m,{class:"system__template","body-style":{height:"100%",overflow:"hidden",paddingBottom:"0"}},{default:n(()=>[e(o,{vertical:"",class:"h-100"},{default:n(()=>[e(lt),f("div",gt,[t(j)==="table"?(i(),v(ft,{key:0})):(i(),v(mt,{key:1}))]),e(et),e(ot)]),_:1})]),_:1})}}});export{kt as default};
